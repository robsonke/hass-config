- id: '1618070798660'
  alias: Battery - Low battery level detection & notification for all battery sensors
  description: Low battery level detection & notification for all battery sensors
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      time: '10:00:00'
      actions:
      - service: notify.mobile_app_iphone_rob
        data:
          message: "\U0001F50B Low battery warning for {{sensors|replace(\"_\",\"
            \")}}"
          data:
            persistent: true
            tag: persistent
- id: alarm_auto_arm_when_away
  alias: Alarm - Auto arm since we're away and all is closed
  description: We didn't enable the Guest mode and we both left, arm the house
  trigger:
  - platform: numeric_state
    entity_id: zone.home
    for:
      hours: 0
      minutes: 3
      seconds: 0
    below: '1'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: disarmed
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - service: notify.all_phones
    data:
      message: ⏰ We zijn beiden weg, het alarm wordt geactiveerd
      data:
        persistent: true
        tag: persistent
  - service: alarm_control_panel.alarm_arm_away
    target:
      entity_id: alarm_control_panel.alarmo
    data: {}
  mode: single
- id: alarm_auto_disarm_when_arriving
  alias: Alarm - Disarm automatically when one of us comes home
  description: Automatically disarm when we come home
  trigger:
  - platform: state
    entity_id:
    - device_tracker.rob_presence
    - device_tracker.steffi_presence
    to: just_arrived
    for: 0:00:30
  - platform: state
    entity_id: device_tracker.ix3
    to: home
    from: not_home
  condition:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: armed_away
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: armed_home
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: pending
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: triggered
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: arming
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - service: notify.all_phones
    data:
      message: ⏰ Een van ons komt thuis, het alarm wordt gedeactiveerd.
      data:
        persistent: true
        tag: persistent
  - service: alarm_control_panel.alarm_disarm
    data:
      code: automation
    target:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: alarm_trigger_when_armed_away
  alias: Alarm - Trigger when door and window status change
  description: Change the alarm state to triggering when an important door or window
    opens
  trigger:
  - platform: state
    entity_id: sensor.doors_windows_open_count
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.state | int > trigger.from_state.state |
      int }}'
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: armed_away,armed_home,armed_night
  action:
  - service: alarm_control_panel.alarm_trigger
    entity_id: alarm_control_panel.alarmo
  mode: single
- id: alarm_triggered_alert
  alias: Alarm - Triggered BEEP BEEP BEEP
  description: Now we are in trouble, the alarm is triggered and we have not disarmed
    it. A lot of noise and lights will be activated.
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarmo
    to: triggered
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F6A8\U0001F6A8 ALARM! Het alarm gaat af en is te laat gedeactiveerd!
        \U0001F6A8\U0001F6A8"
      data:
        persistent: true
        tag: persistent
        push:
          sound: alarm.caf
          critical: 1
          volume: 1
          interruption-level: critical
        actions:
        - action: URI
          title: Bekijk cams
          uri: /lovelace/4
        - action: SILENCE_ALARM
          title: Alarm uit
          icon: sfsymbols:bell.slash
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.alarm_active
  - repeat:
      while:
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: triggered
      - condition: template
        value_template: '{{ repeat.index <= 20 }}'
      sequence:
      - service: script.sonos_say
        data:
          sonos_entity: media_player.living_room
          volume: 0.3
          message: Je bent gezien en wordt nu gefilmd!
          delay: 00:00:03
      - service: script.sonos_play_sound
        data:
          mp3_url: https://home.tigrou.nl/local/sounds/alarm2.mp3
          volume: 0.3
          sonos_entity: media_player.living_room
          delay: 00:00:10
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.alarm_active
  mode: single
- id: alarm_pending_trigger
  alias: Alarm - Pending
  description: Warn the person that walked in about the armed alarm, goal is to disarm
    asap
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarmo
    to: pending
  action:
  - service: script.sonos_say
    data:
      sonos_entity: media_player.living_room
      volume: 0.5
      message: Je bent gezien, deactiveer het alarm binnen 2 minuten!
      delay: 00:00:03
  - service: browser_mod.popup
    data:
      title: Alarm actief
      content:
        type: custom:alarmo-card
        entity: alarm_control_panel.alarmo
  - repeat:
      while:
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: pending
      - condition: template
        value_template: '{{ repeat.index <= 10 }}'
      sequence:
      - service: script.sonos_play_sound
        data:
          mp3_url: https://home.tigrou.nl/local/sounds/pending_alarm.mp3
          volume: 0.4
          sonos_entity: media_player.living_room
          delay: 00:00:01
- id: alarm_disarm_correctly
  alias: Alarm - Disarmed
  description: Send a message that the alarm is properly disarmed and inform the person
    over speakers
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarmo
    from: triggered,pending
    to: disarmed
  action:
  - service: notify.all_phones
    data:
      message: '✅ ALARM: Het alarm is uitgezet.'
      data:
        persistent: true
        tag: persistent
  - service: tts.google_translate_say
    entity_id: media_player.keuken_display
    data:
      message: Het alarm is uitgeschakeld
  mode: single
- alias: Mail - Alert when mail in the mailbox
  id: mailbox_notification
  description: See if there's a vibration in the mailbox, identifying new mail
  trigger:
  - entity_id: binary_sensor.mailbox_vibration_sensor
    platform: state
    to: vibration
  condition:
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.mailbox_notification.attributes.last_triggered,
      0) | int > 20 }}'
  - condition: template
    value_template: '{{ states.automation.mailbox_notification.attributes.last_triggered
      != none }}'
  action:
  - service: notify.all_phones
    data:
      message: ✉ Er is post bezorgd.
      data:
        persistent: true
        tag: persistent
- id: reset_lights_automation
  alias: Lights - Reset lights automation
  description: When we have disabled all automatic lighting, we reset this in the
    early morning to make sure we're back to normal the next day
  trigger:
  - platform: time
    at: 05:00:00
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.enable_automatic_garden_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.enable_automatic_screens
      state: 'off'
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.enable_automatic_lights
  - service: input_boolean.turn_on
    entity_id: input_boolean.enable_automatic_garden_lights
  - service: input_boolean.turn_on
    data: {}
- id: groundfloor_lights_on_when_dark_away
  alias: Lights - Turn on lights when dark - away
  description: Switch standard lights on when it's after 2 PM and light level too
    low
  trigger:
  - platform: numeric_state
    entity_id: sensor.lightlevel_living
    below: '30'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: light.zwave_light_couch_level
      state: 'off'
    - condition: time
      after: '14:00'
      before: '22:30'
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'on'
    - condition: state
      entity_id: zone.home
      state: '0'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - service: notify.mobile_app_iphone_rob
    data:
      message: "\U0001F4A1 Verlichting automatisch aan - niet thuis"
      data:
        persistent: true
        tag: persistent
  - service: script.lights_on_away
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  mode: single
- id: groundfloor_lights_on_when_dark_home
  alias: Lights - Turn on lights when dark - home
  description: Switch standard lights on when it's after 2 PM and light level too
    low
  trigger:
  - platform: numeric_state
    entity_id: sensor.lightlevel_living
    below: '30'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  condition:
  - condition: and
    conditions:
    - condition: time
      after: '10:00'
      before: '22:30'
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'on'
    - condition: state
      entity_id: binary_sensor.template_people_home_and_awake
      state: 'on'
  - condition: device
    device_id: 29fa064f108236608f9f0d8f063dbc17
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: is_disarmed
  action:
  - service: script.lights_on_home
    data: {}
  - delay: '1'
  mode: single
- id: backup_snapshots_stale
  alias: Backup - Snapshots went stale
  description: Send a push message when the backups are failing
  trigger:
  - platform: state
    entity_id: binary_sensor.snapshots_stale
    from: 'False'
    to: 'True'
  condition: []
  action:
  - service: notify.mobile_app_iphone_rob
    data:
      title: "\U0001F6A8\U0001F6A8 Snapshots are Stale \U0001F6A8\U0001F6A8"
      message: Please visit the Hass.io Google Drive Backup add-on status page for
        details.
      data:
        persistent: true
        tag: persistent
- id: calendar_trash_alert
  alias: Calendar - Afval Calendar Alert
  description: Send messages when a trash bin should be put outside
  trigger:
  - entity_id: sensor.template_gft_days_until_collection
    platform: state
    to: '1'
    for:
      hours: 20
      minutes: 0
      seconds: 0
  - entity_id: sensor.template_rest_days_until_collection
    platform: state
    to: '1'
    for:
      hours: 20
      minutes: 0
      seconds: 0
  - entity_id: sensor.template_paper_days_until_collection
    platform: state
    to: '0'
    for:
      hours: 16
      minutes: 0
      seconds: 0
  action:
  - service: notify.all_phones
    data_template:
      message: "\U0001F4C5  Opletten {{ state_attr(trigger.entity_id, 'friendly_name')
        }}!"
      data:
        persistent: true
        tag: persistent
- id: doorbell_ring_notification
  alias: Doorbell - Notification Doorbell Ring
  description: Say ding dong through the speakers when doorbell rings
  trigger:
  - platform: state
    entity_id: binary_sensor.doorbell_lw_doorbell
    from: 'off'
    to: 'on'
  action:
  - service: script.googlehome_play_sound
    data:
      volume: 0.7
      volume_restore: 0.4
      googlehome_entity: media_player.office_googlehome
      delay: 00:00:03
      mp3_url: https://home.tigrou.nl/local/sounds/doorbell2.mp3
  - service: script.googlehome_play_sound
    data:
      volume: 0.7
      volume_restore: 0.4
      googlehome_entity: media_player.bedroom_googlehome
      delay: 00:00:03
      mp3_url: https://home.tigrou.nl/local/sounds/doorbell2.mp3
  - service: script.googlehome_play_sound
    data:
      volume: 0.7
      volume_restore: 0.4
      googlehome_entity: media_player.living_googlehome
      delay: 00:00:03
      mp3_url: https://home.tigrou.nl/local/sounds/doorbell2.mp3
  - service: notify.all_phones
    data:
      message: "\U0001F514 Ding Dong!"
      data:
        persistent: true
        tag: persistent
        image: http://admin:qg4Y7DhhCTNJnCtuAZp_zJM@192.168.0.246/cgi-bin/snapshot.cgi
  - service: script.googlehome_play_sound
    data:
      volume: 0.7
      volume_restore: 0.4
      googlehome_entity: media_player.keuken_display
      delay: 00:00:03
      mp3_url: https://home.tigrou.nl/local/sounds/doorbell2.mp3
- id: garden_lights_turn_on
  alias: Garden - Turn on garden lights
  description: When it's getting dark and at least after 4 PM, turn on lights in the
    garden
  trigger:
  - platform: numeric_state
    entity_id: sensor.light_sensor_garden
    below: '10'
  - platform: time
    at: 07:00
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: '-3'
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: time
        after: '16:00'
      - condition: time
        before: '22:55'
      - condition: state
        entity_id: input_boolean.enable_automatic_garden_lights
        state: 'on'
      - condition: state
        entity_id: light.dimmer_cabinroof_level
        state: 'off'
    - condition: and
      conditions:
      - condition: time
        after: 06:15
      - condition: time
        before: 08:55
      - condition: state
        entity_id: input_boolean.enable_automatic_garden_lights
        state: 'on'
      - condition: state
        entity_id: light.dimmer_cabinroof_level
        state: 'off'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.lightlevel_living
          below: '10'
        - condition: numeric_state
          entity_id: sun.sun
          attribute: elevation
          below: '-4'
  - condition: state
    entity_id: light.garden_lantern_light1
    state: 'off'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  action:
  - service: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id: light.garden_light
  - service: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id: light.garden_lantern_light1
  - service: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id: light.garden_lantern_light2
  - service: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id: light.garden_lantern_light3
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - service: light.turn_on
    data:
      brightness_pct: 15
    target:
      entity_id: light.dimmer_cabinroof_level
  - service: light.turn_on
    data: {}
    target:
      entity_id: group.hue_lights_garden
  mode: single
- id: garden_lights_turn_off
  alias: Garden - Turn off garden lights - morning
  description: Turn off lights in the garden in the morning
  trigger:
  - platform: time
    at: 09:00
  - platform: numeric_state
    entity_id: sensor.light_sensor_garden
    above: 5
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.enable_automatic_garden_lights
    state: 'on'
  action:
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.dimmer_cabinroof_level
      - group.hue_lights_garden
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.garden_lantern_light1
      - light.garden_lantern_light2
      - light.garden_lantern_light3
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.garden_light
  mode: single
- id: lights_turn_off_bedtime_manual
  alias: Sleep - Switch to night mode manually
  description: Go to bed switch, turn off all we don't need during the night. Lights,
    music, tv, etc. And turn on the alarm
  trigger:
  - platform: state
    entity_id: input_boolean.night_mode
    from: 'off'
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: time
      after: '21:00:00'
    - condition: time
      before: 05:00
  action:
  - service: script.sleep_well
  - service: alarm_control_panel.alarm_arm_night
    target:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: lights_turn_off_bedtime_auto
  alias: Lights - Turn off lights automatically - bedtime
  description: Turn off main lights when we're not home or already went to bed
  trigger:
  - platform: time_pattern
    minutes: /1
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: light.zwave_light_couch_level
      state: 'on'
    - condition: time
      after: '23:03'
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'on'
    - condition: state
      entity_id: zone.home
      state: '0'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - service: notify.mobile_app_iphone_rob
    data:
      message: "\U0001F4A1 Verlichting automatisch uit"
      data:
        persistent: true
        tag: persistent
  - service: script.sleep_well
    data: {}
  mode: single
- id: closet_light_turn_on
  alias: Lights - Turn on lights when closet door opens
  trigger:
  - platform: state
    entity_id: binary_sensor.door_hallcloset_openclose_sensor
    from: 'off'
    to: 'on'
  action:
  - service: light.turn_on
    entity_id: light.hallcloset
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.door_hallcloset_openclose_sensor
      from: 'on'
      to: 'off'
  - service: light.turn_off
    target:
      entity_id: light.hallcloset
- id: lights_kitchen_turn_on_when_awake_morning
  alias: Lights - Turn on lights when hallway door opens in the early morning
  trigger:
  - platform: state
    entity_id: binary_sensor.hallwaydoor_openclose_sensor
    from: 'off'
    to: 'on'
  condition:
  - condition: time
    after: 04:00
    before: '11:00:00'
  - condition: state
    entity_id: input_boolean.night_mode
    state: 'on'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  action:
  - service: alarm_control_panel.alarm_disarm
    data:
      code: automation
    target:
      entity_id: alarm_control_panel.alarmo
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.night_mode
    data: {}
  - choose:
    - conditions:
      - condition: time
        after: 06:00
      - condition: numeric_state
        entity_id: zone.home
        above: '0'
      sequence:
      - service: media_player.media_play
        data: {}
        target:
          entity_id: media_player.eetkamer
  - condition: numeric_state
    entity_id: sensor.lightlevel_living
    below: '60'
  - service: light.turn_on
    data:
      brightness_pct: 40
    target:
      entity_id:
      - light.kitchendesk_light
      - light.diningtable_light
  mode: single
- id: restart_ssh_addon
  alias: Hass - Restart SSH Addon
  description: Restart the ssh addon after a HA restart, required to get the hassio.addon_stdin
    to work
  trigger:
  - platform: homeassistant
    event: start
  - platform: time
    at: 01:00:00
  action:
  - delay: 00:04
  - service: hassio.addon_restart
    data:
      addon: a0d7b954_ssh
  - delay: 00:01
  - service: hassio.addon_stdin
    data:
      addon: a0d7b954_ssh
      input: bash /config/cast.sh
  mode: single
- alias: System - Let's Encrypt Renewal
  id: system_lets_encrypt
  description: Restart the lets encrypt addon, this should renew the certificate
  trigger:
    platform: time
    at: 01:15:00
  action:
  - service: hassio.addon_restart
    data:
      addon: core_letsencrypt
- alias: Lights - Check if automatic lights are disabled by accident
  id: lights_reset_disabled_accidentally
  description: Check every hour if this wasn't done by accident
  trigger:
    platform: time_pattern
    hours: /1
  condition:
    condition: and
    conditions:
    - condition: time
      after: 05:30:00
      before: '20:30:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.enable_automatic_lights
        state: 'off'
      - condition: state
        entity_id: input_boolean.enable_automatic_garden_lights
        state: 'off'
  action:
    service: notify.mobile_app_iphone_rob
    data:
      message: De automatische verlichting is uitgeschakeld, dit is mogelijk onbewust.
      data:
        persistent: true
        tag: persistent
        actions:
        - action: URI
          title: Open Hass
          uri: /lovelace/0
- alias: Presence - Presence detection message
  id: presence_detection_message
  description: Send a push message in case the presence of a person changes
  trigger:
    platform: state
    for:
      seconds: 15
    entity_id:
    - device_tracker.rob_presence
    - device_tracker.steffi_presence
  condition:
  - condition: numeric_state
    entity_id: sensor.ha_uptime_minutes
    above: 3
  - condition: template
    value_template: '{{ trigger.to_state.state != trigger.from_state.state }}'
  action:
    service: notify.all_phones
    data_template:
      message: "\U0001F3E0 Status van {{ state_attr(trigger.entity_id, 'friendly_name')
        }} gewijzigd naar {{ trigger.to_state.state }}"
      data:
        persistent: true
        tag: persistent
- id: presence_detection_message_speakers
  alias: Presence - Inform that one of us comes home
  description: Shout through speakers that somebody is arriving when the other one
    is home
  trigger:
  - platform: state
    for:
      seconds: 15
    entity_id:
    - device_tracker.rob_presence
    - device_tracker.steffi_presence
    to: just_arrived
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: person.rob
      state: home
    - condition: state
      entity_id: person.steffi
      state: home
  - condition: state
    state: 'off'
    entity_id: input_boolean.guest_mode
  action:
  - service: script.googlehome_say
    data_template:
      volume: 0.5
      volume_restore: 0.4
      googlehome_entity: media_player.keuken_display
      delay: 3
      message: Wakker worden, {{ state_attr(trigger.entity_id, 'friendly_name') }}
        komt er aan!
  - delay: '2'
  - service: script.googlehome_say
    data_template:
      volume: 0.5
      volume_restore: 0.4
      googlehome_entity: media_player.office_googlehome
      delay: 3
      message: Wakker worden, {{ state_attr(trigger.entity_id, 'friendly_name') }}
        komt er aan!
  - delay: '5'
  mode: single
- id: presence_frigate_object_detection
  alias: Alarm - Notify of person events on camera
  trigger:
  - platform: mqtt
    topic: frigate/events
  condition:
  - condition: or
    conditions:
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_night
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_away
  - condition: template
    value_template: '{{ trigger.payload_json[''after''][''label''] == ''person'' }}'
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''achterdeur''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''terras''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''veranda''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''bijkeuken''
        }}'
  action:
  - service: notify.all_phones
    data_template:
      message: Er is een {{trigger.payload_json["after"]["label"]}} gedetecteerd op
        de {{ trigger.payload_json["after"]["camera"] }} camera
      data:
        persistent: true
        image: https://home.tigrou.nl/api/frigate/notifications/{{trigger.payload_json["after"]["id"]}}/thumbnail.jpg
        tag: '{{trigger.payload_json["after"]["id"]}}'
        when: '{{trigger.payload_json["after"]["start_time"]|int}}'
        entity_id: camera.{{trigger.payload_json["after"]["camera"]}}
  mode: single
- alias: Theme - Switch to dark mode
  id: theme_switch_dark
  trigger:
  - platform: time
    at: '22:00:00'
  - platform: sun
    event: sunset
  condition: '{{ is_state(''input_boolean.dark_mode'', ''off'') }}'
  action:
    entity_id: input_boolean.dark_mode
    service: input_boolean.turn_on
- alias: Theme - Switch to light mode
  id: theme_switch_light
  trigger:
  - platform: time
    at: 09:00:00
  - platform: sun
    event: sunrise
  condition: '{{ is_state(''input_boolean.dark_mode'', ''on'') }}'
  action:
    entity_id: input_boolean.dark_mode
    service: input_boolean.turn_off
- id: theme_switch_manually
  alias: Theme - Change theme manually
  trigger:
  - platform: state
    entity_id: input_boolean.dark_mode
  action:
  - service: browser_mod.set_theme
    data_template:
      theme: custom-dark
      dark: "{% if is_state(\"input_boolean.dark_mode\", \"on\") %}\n  dark\n{% else
        %}\n  light\n{% endif %}\n"
- id: lovelace_convert_json_yaml
  alias: Lovelace - convert lovelace.json to lovelace-ui.yaml
  trigger:
  - platform: state
    entity_id: sensor.lovelace_size
  action:
  - service: shell_command.convert_lovelace
    data: {}
- id: sjorsje_bin_full
  alias: Vacuum - Sjorsje Bin Full
  trigger:
  - entity_id: binary_sensor.sjorsje_bin_full
    platform: state
    to: 'on'
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F9F9 Sjorsje's opvangbak zit vol"
      data:
        persistent: true
        tag: persistent
- alias: Vacuum - Sjorsje Battery Empty
  id: sjorsje_battery_empty
  trigger:
  - entity_id: sensor.sjorsje_battery_level
    platform: numeric_state
    below: 20
  action:
    service: notify.all_phones
    data:
      message: "\U0001F50B Sjorsje's accu raakt leeg"
      data:
        persistent: true
        tag: persistent
- id: '1618729855664'
  alias: Laundry - Laundry ready
  description: ''
  use_blueprint:
    path: sbyx/notify-or-do-something-when-an-appliance-like-a-dishwasher-or-washing-machine-finishes.yaml
    input:
      power_sensor: sensor.wasmachine_switch_current_consumption
      actions:
      - service: notify.all_phones
        data:
          message: De wasmachine is klaar
          data:
            persistent: true
            tag: persistent
      starting_hysteresis: 1
- id: '1618732336311'
  alias: Dishwasher - Dishwasher ready
  description: ''
  use_blueprint:
    path: sbyx/notify-or-do-something-when-an-appliance-like-a-dishwasher-or-washing-machine-finishes.yaml
    input:
      power_sensor: sensor.vaatwasser_switch_current_consumption
      actions:
      - service: notify.all_phones
        data:
          message: De vaatwasser is klaar
          data:
            persistent: true
            tag: persistent
      - service: tts.google_translate_say
        entity_id: media_player.office_googlehome
        data_template:
          message: De vaatwasser is klaar
- id: '1620153875064'
  alias: Alarm - Reset night mode when home
  description: In the early morning disable the night mode again - disabled, the door
    should do this
  trigger:
  - platform: time
    at: '10:00'
  - platform: state
    entity_id: binary_sensor.hallwaydoor_openclose_sensor
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  condition:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: time
        after: 07:00
      - condition: state
        entity_id: binary_sensor.hallwaydoor_openclose_sensor
        state: 'on'
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_night
  action:
  - service: alarm_control_panel.alarm_disarm
    data:
      code: automation
    target:
      entity_id: alarm_control_panel.alarmo
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.night_mode
  mode: single
- id: '1620203713941'
  alias: Locks - Auto lock the doors
  description: We didn't enable the Guest mode and we both left, lock the doors if
    they are not
  trigger:
  - platform: state
    entity_id:
    - zone.home
    to: '0'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: lock.nuki_voordeur_slot_lock
      state: unlocked
  action:
  - service: lock.lock
    target:
      entity_id: lock.nuki_voordeur_slot_lock
    data: {}
  mode: single
- id: '1621189950296'
  alias: Presence - Enable detection because one of us left or in night mode
  description: Activate Frigate object detection
  trigger:
  - platform: state
    for:
      hours: 0
      minutes: 0
      seconds: 15
    entity_id:
    - zone.home
    to: '1'
  - platform: state
    entity_id: input_boolean.night_mode
    from: 'off'
    to: 'on'
  - platform: numeric_state
    entity_id: zone.home
    below: '2'
  condition: []
  action:
  - service: switch.turn_on
    target:
      entity_id:
      - switch.achterdeur_detect
      - switch.terras_detect
      - switch.veranda_detect
      - switch.bijkeuken_detect
      - switch.evabed_detect
    data: {}
  mode: single
- id: '1621190465429'
  alias: Presence - Disable detection because day starts
  description: Deactivate Frigate object detection
  trigger:
  - platform: state
    entity_id: input_boolean.night_mode
    from: 'on'
    to: 'off'
  condition:
  - condition: state
    entity_id: input_boolean.night_mode
    state: 'off'
  action:
  - service: switch.turn_off
    target:
      entity_id:
      - switch.achterdeur_detect
      - switch.terras_detect
      - switch.veranda_detect
      - switch.bijkeuken_detect
      - switch.evabed_detect
  mode: single
- id: '1621192167984'
  alias: Night - Check for open windows and doors
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.night_mode
    from: 'off'
    to: 'on'
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.open_windows_and_doors_downstairs
      state: '0'
  action:
  - service: tts.google_translate_say
    entity_id: media_player.keuken_display
    data_template:
      message: Let op, er staan beneden nog ramen of deuren open!
  mode: single
- id: '1621192941666'
  alias: Doors - Alert when frontdoor is open too long
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.frontdoor_openclose_sensor
    for: '1800'
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F6AA Deur: let op, de voordeur staat al 10 minuten open"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1621232858848'
  alias: Doors - Nuki battery critical
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.nuki_voordeur_slot_battery_critical
    to: 'on'
    for:
      hours: 1
      minutes: 0
      seconds: 0
    from: 'off'
  condition: []
  action:
  - service: notify.all_phones
    data_template:
      message: Let op, batterij status van het voordeur slot is kritiek!
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1623609811213'
  alias: Screens - Close screens voorraam on warm sunny days
  description: In case it's warm and sunny, close the screens in the morning but the
    one on the side a bit later
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.openweathermap_forecast_temperature
          above: '20'
        - condition: numeric_state
          entity_id: sensor.openweathermap_forecast_cloud_coverage
          below: '80'
      - condition: numeric_state
        entity_id: sensor.openweathermap_forecast_temperature
        above: '22'
    - condition: device
      device_id: eb69e1ad4596ef0df19b685a4e84e026
      domain: cover
      entity_id: cover.voorraam
      type: is_open
  - condition: time
    after: 09:00:00
    before: '17:00:00'
  - condition: state
    entity_id: sensor.rate_rain_piezo
    state: '0.0'
  - condition: state
    entity_id: input_boolean.enable_automatic_screens
    state: 'on'
  action:
  - service: notify.all_phones
    data:
      message: ☀️ De screens aan de voorkant gaan dicht
      data:
        persistent: true
        tag: persistent
  - service: cover.close_cover
    data: {}
    target:
      entity_id: cover.voorraam
  trace:
    stored_traces: 20
  mode: single
- id: '1623609934943'
  alias: Screens - Open screen voorraam
  description: Open the screen by the end of the day or when the sun is gone or when
    it's too windy
  trigger:
  - platform: time
    at: '18:00:00'
  - platform: numeric_state
    entity_id: sensor.openweathermap_forecast_cloud_coverage
    above: '90'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - platform: numeric_state
    entity_id: sensor.rate_rain_piezo
    for:
      hours: 0
      minutes: 0
      seconds: 10
    above: '0'
    below: '1000'
  condition:
  - condition: and
    conditions:
    - condition: device
      device_id: eb69e1ad4596ef0df19b685a4e84e026
      domain: cover
      entity_id: cover.voorraam
      type: is_closed
    - condition: state
      entity_id: input_boolean.enable_automatic_screens
      state: 'on'
  action:
  - service: notify.all_phones
    data:
      message: ☀️ De screen aan de voorkant gaat open
      data:
        persistent: true
        tag: persistent
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.voorraam
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.voorraam
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.voorraam
  mode: single
- id: '1623610181205'
  alias: Screens - Open screen zijraam
  description: Open the screen by the end of the day or when the sun is gone or it's
    too windy
  trigger:
  - platform: time
    at: '21:00'
  - platform: numeric_state
    entity_id: sensor.openweathermap_forecast_cloud_coverage
    above: '90'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - platform: sun
    event: sunset
    offset: -00:30:00
  - platform: numeric_state
    entity_id: sensor.rate_rain_piezo
    for:
      hours: 0
      minutes: 0
      seconds: 10
    above: '0'
    below: '1000'
  condition:
  - condition: and
    conditions:
    - condition: device
      device_id: 7a674f956b15af8decebb36355772928
      domain: cover
      entity_id: cover.zijraam
      type: is_closed
  - condition: state
    entity_id: input_boolean.enable_automatic_screens
    state: 'on'
  action:
  - service: notify.all_phones
    data:
      message: ☀️ De screen aan de zijkant gaat open
      data:
        persistent: true
        tag: persistent
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.zijraam
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.zijraam
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.zijraam
  mode: single
- id: '1623656513564'
  alias: Sleep - Switch to night mode automatically when home
  description: In case we're home but forgot night mode, do it for us
  trigger:
  - platform: time
    at: 00:30
  condition:
  - condition: state
    entity_id: input_boolean.night_mode
    state: 'off'
  - condition: state
    entity_id: device_tracker.rob_presence
    state: home
  - condition: state
    entity_id: device_tracker.steffi_presence
    state: home
  - condition: state
    entity_id: light.zwave_light_couch_level
    state: 'off'
  - condition: state
    entity_id: binary_sensor.hallwaydoor_openclose_sensor
    state: 'off'
  action:
  - service: script.sleep_well
  - service: alarm_control_panel.alarm_arm_night
    target:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1624807756444'
  alias: Car - Alert when fully charged
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.ix3_remaining_battery_percent
    to: '100'
    for: 00:00:30
  condition:
  - condition: state
    entity_id: binary_sensor.ix3_connection_status
    state: 'on'
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F697 De auto is weer volledig opgeladen"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1625051357630'
  alias: Presence - Disable detection because we are both home
  description: Deactivate Frigate object detection
  trigger:
  - platform: state
    for: 0:00:15
    entity_id: device_tracker.rob_presence,device_tracker.steffi_presence
    to: home
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: person.rob
      state: home
    - condition: state
      entity_id: person.steffi
      state: home
  action:
  - service: switch.turn_off
    target:
      entity_id:
      - switch.achterdeur_detect
      - switch.terras_detect
      - switch.veranda_detect
      - switch.bijkeuken_detect
      - switch.evabed_detect
  mode: single
- id: '1625685392220'
  alias: Car - Alert when full and still plugged in
  description: Time to remove the cable
  trigger:
  - platform: state
    entity_id: sensor.ix3_remaining_battery_percent
    to: '100'
    for: 01:00:00
  condition:
  - condition: state
    entity_id: binary_sensor.ix3_connection_status
    state: 'on'
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F697 De auto is al een uurtje opgeladen maar de stekker zit
        er nog in"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1625685710817'
  alias: Car - Lock the doors when open too long
  description: Lock the car automatically after 15 minutes
  trigger:
  - platform: state
    entity_id: binary_sensor.ix3_door_lock_state
    to: 'on'
    for: 02:00:00
  condition: []
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F697 De auto is automatisch op slot gezet"
      data:
        persistent: true
        tag: persistent
  - service: lock.lock
    target:
      entity_id: lock.ix3_lock
  mode: single
- id: '1625773685228'
  alias: Alarm - Disable alarm manually
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.switch_alarm_activity_action
    to: 'on'
  condition:
  - condition: not
    conditions:
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_disarmed
  action:
  - device_id: 29fa064f108236608f9f0d8f063dbc17
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: disarm
    code: automation
  - delay:
      hours: 1
      minutes: 55
      seconds: 0
      milliseconds: 0
  - service: script.sonos_say
    data:
      sonos_entity: media_player.living_room
      volume: 0.3
      message: Let op, het alarm wordt over 5 minuten weer geactiveerd.
      delay: 00:00:10
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - device_id: 29fa064f108236608f9f0d8f063dbc17
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: arm_away
  - service: notify.all_phones
    data:
      message: De tijd is om, het alarm wordt weer geactiveerd.
      data:
        persistent: true
        tag: persistent
  - service: script.sonos_say
    data:
      sonos_entity: media_player.living_room
      volume: 0.3
      message: Let op, het alarm is weer geactiveerd. Druk op de knop om het weer
        uit te zetten.
      delay: 00:00:06
  mode: single
- id: '1625814711652'
  alias: Doors - Alert when backdoor is open too long
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.backdoor_openclose_sensor
    for: '1800'
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F6AA Deur: let op, de achterdeur staat al 10 minuten open"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1627719809039'
  alias: Doors - Alert when sheddoor is open too long and we're away
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.sheddoor_openclose_sensor
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.sheddoor_back_openclose_sensor
    from: 'off'
    to: 'on'
  - platform: state
    entity_id:
    - binary_sensor.cabindoor_openclose_contact
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: zone.home
    state: '0'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: not
    conditions:
    - condition: state
      entity_id: person.steffi
      state: just_arrived
  - condition: not
    conditions:
    - condition: state
      entity_id: person.rob
      state: just_arrived
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F6AA Deur: let op, de schuur- of blokhutdeur gaat open maar
        wij zijn niet thuis"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1628796760216'
  alias: Alarm - Turn on lights when person events on camera
  description: ''
  trigger:
  - platform: mqtt
    topic: frigate/events
  condition:
  - condition: or
    conditions:
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_night
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_away
  - condition: template
    value_template: '{{ trigger.payload_json[''after''][''label''] == ''person'' }}'
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''achterdeur''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''terras''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''veranda''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''bijkeuken''
        }}'
  - condition: numeric_state
    entity_id: sensor.light_sensor_garden
    below: '10'
  - condition: state
    entity_id: light.garden_light
    state: 'off'
  action:
  - service: light.turn_on
    target:
      entity_id:
      - light.garden_light
      - light.dimmer_cabinroof_level
  - service: notify.all_phones
    data:
      message: Er is een persoon gedetecteerd op een camera!
      data:
        persistent: true
        tag: persistent
        push:
          sound: alarm.caf
          critical: 1
          volume: 1
          interruption-level: critical
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    target:
      entity_id:
      - light.garden_light
      - light.dimmer_cabinroof_level
  mode: single
- id: '1629016952694'
  alias: Alarm - Notify why arming failed
  description: ''
  trigger:
  - platform: event
    event_type: alarmo_failed_to_arm
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.reason == ''open_sensors'' }}'
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F6A8 Alarm kan niet geactiveerd worden omdat: {% for entity_id
        in trigger.event.data.sensors %}\n  - {{ state_attr(entity_id, 'friendly_name')
        }} is {{ states(entity_id) }}\n{% endfor %}\n"
      data:
        persistent: true
        tag: persistent
  - service: tts.google_translate_say
    entity_id: media_player.keuken_display
    data:
      message: "Alarm kan niet geactiveerd worden omdat: {% for entity_id in trigger.event.data.sensors
        %}\n  - {{ state_attr(entity_id, 'friendly_name') }} staat {{ states(entity_id)
        }}\n{% endfor %}\n"
  mode: single
- id: '1633552734408'
  alias: Alarm - Enable guest mode when nanny home
  description: Enable on Thursday when we're away or leaving the house
  trigger:
  - platform: time
    at: '14:00'
  - platform: state
    entity_id:
    - zone.home
    to: '0'
  condition:
  - condition: time
    weekday:
    - thu
    before: '18:30'
    after: '13:50'
  - condition: state
    entity_id: zone.home
    state: '0'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.guest_mode
    data: {}
  - device_id: 29fa064f108236608f9f0d8f063dbc17
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: disarm
    code: automation
  - service: notify.all_phones
    data:
      message: Guest modus aangezet en alarm uit voor Maartje
      data:
        persistent: true
        tag: persistent
  - delay:
      hours: 5
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.guest_mode
    data: {}
  mode: single
- id: '1635279877594'
  alias: Lights - Turn on lights when dark - arriving
  description: When we come home after sunset, a few lights are on, so turn on more
    lights
  trigger:
  - platform: state
    entity_id: device_tracker.rob_presence,device_tracker.steffi_presence
    to: just_arrived
    for: 0:00:30
  - platform: state
    entity_id: device_tracker.ix3
    from: not_home
    to: home
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: zone.home
      state: '0'
    - condition: state
      entity_id: light.livingfront_light
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.lightlevel_living
      below: '30'
  action:
  - service: script.lights_on_home
    data: {}
  mode: single
- id: '1635280472840'
  alias: Lights - Turn off lights when dark - leaving
  description: We leave the house in when dark, turn off a few lights
  trigger:
  - platform: state
    entity_id:
    - zone.home
    to: '0'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.livingfront_light
        state: 'on'
      - condition: state
        entity_id: light.kitchendesk_light
        state: 'on'
      - condition: state
        entity_id: light.diningtable_light
        state: ''
  action:
  - service: light.turn_off
    target:
      entity_id:
      - light.kitchendesk_light
      - light.diningtable_light
      - light.livingfront_light
      - light.office_lights
    data: {}
  - service: light.turn_on
    target:
      entity_id:
      - light.livingback_light
      - light.kitchen_light
      - light.dining_light
      - light.zwave_light_couch_level
      - light.zwave_light_corner_level
    data:
      brightness_pct: 30
  mode: single
- id: '1635280845679'
  alias: Lights - Turn off lights when lighter
  description: Turn off lights in the morning or during the day after a darker period
  trigger:
  - platform: numeric_state
    entity_id: sensor.lightlevel_living
    above: '60'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: time
      after: 05:00
      before: '22:30'
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.zwave_light_corner_level
        state: 'on'
      - condition: state
        entity_id: light.kitchendesk_light
        state: 'on'
  action:
  - service: script.lights_down_stairs_off
    data: {}
  mode: single
- id: '1635281191811'
  alias: Music - Turn off music when we left
  description: We didn't enable the Guest mode and we both left, stop the music
  trigger:
  - platform: state
    entity_id:
    - zone.home
    to: '0'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: disarmed
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - service: media_player.media_pause
    target:
      entity_id:
      - media_player.eetkamer
      - media_player.office
      - media_player.living_room
    data: {}
  mode: single
- id: '1636140145870'
  alias: Fire - Stookalert active
  description: There's a Dutch RIVM Stookalert
  trigger:
  - platform: state
    entity_id: binary_sensor.stookalert_zeeland
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.all_phones
    data:
      message: Het RIVM heeft een stookalert afgegeven, kacheltje uit.
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1636140398636'
  alias: Garden - Turn off fountain
  description: Lets cool down during the night
  trigger:
  - platform: time
    at: '23:00'
  condition:
  - condition: device
    type: is_on
    device_id: 22419e692ce37ce9f67caf3e62da99e4
    entity_id: switch.pool_fountain
    domain: switch
  action:
  - service: switch.turn_off
    data: {}
    target:
      entity_id: switch.pool_fountain
  mode: single
- id: '1636140450532'
  alias: Garden - Turn on fountain
  description: Lets float in daytime
  trigger:
  - platform: time
    at: 07:00
  condition:
  - condition: device
    type: is_off
    device_id: 22419e692ce37ce9f67caf3e62da99e4
    entity_id: switch.pool_fountain
    domain: switch
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.pool_fountain
  mode: single
- id: '1636140714636'
  alias: Car - Alert when car windows open too long
  description: Lets not let the rain in for too long, again
  trigger:
  - platform: state
    entity_id: binary_sensor.ix3_windows
    to: 'on'
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F697 De ramen van de auto staan al een uurtje open."
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1636204195732'
  alias: System - Notify entities being offline
  description: Check for a specific list of monitored entities if they are available
  trigger:
  - platform: state
    entity_id: sensor.unavailable_entities
    for:
      hours: 0
      minutes: 5
      seconds: 10
    from: Online
  action:
  - service: notify.mobile_app_iphone_rob
    data_template:
      message: "\U0001F4A1 Er is een belangrijke entity offline {{ became_unavailable
        }}"
      data:
        persistent: true
        tag: persistent
        actions:
        - action: URI
          title: Open hardware
          uri: /lovelace/6
  variables:
    from_state: '{{ states(''input_text.unavailable_entities_temp_state'') }}'
    from_state_list: '{{ from_state.split('', '') }}'
    to_state: '{{ trigger.to_state.state if trigger.to_state.state != ''Online'' else
      '''' }}'
    to_state_list: '{{ to_state.split('', '') }}'
    became_online: '{{ from_state_list | reject(''in'', to_state_list) | join('',
      '') }}'
    became_unavailable_list: '{{ to_state_list | reject(''in'', from_state_list) |
      list }}'
    became_unavailable: '{{ became_unavailable_list | join('', '') }}'
    other_unavailable_entities: '{{ to_state_list | reject(''in'', became_unavailable_list)
      | join('', '') }}'
- id: '1636228242323'
  alias: Alarm - Flash lights
  description: If the alarm is triggered, flash the lights in house and garden and
    restore the state afterwards
  use_blueprint:
    path: myGithub-Markus/flashing_lights.yaml
    input:
      target_lights:
        entity_id:
        - light.office_lights
        - light.livingback_light
        - light.livingfront_light
        - light.dining_light
        - light.garden_light
        - light.kitchen_light
      activated: input_boolean.alarm_active
      delay: 500
- id: '1638997192801'
  alias: Lights - Turn off lights upstairs when leaving
  description: When we move away, all upstairs can be turned off
  trigger:
  - platform: state
    entity_id:
    - zone.home
    to: '0'
  condition:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: group.lights_upstairs
    state: 'on'
  action:
  - service: script.lights_off_upstairs
    data: {}
  mode: single
- id: '1639680674230'
  alias: iOS - Good night
  description: Good night action from app or watch
  trigger:
  - platform: event
    event_type: ios.action_fired
    event_data:
      actionName: good_night
  condition:
  - condition: time
    after: '21:00'
    before: 05:00
  action:
  - service: script.sleep_well
  - service: alarm_control_panel.alarm_arm_night
    target:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1639684695002'
  alias: Alarm - Silence alarm by notification
  description: Silence alarm when beeping through push notification action when
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: SILENCE_ALARM
    context:
      user_id:
      - 56ef6157f087451399aa545f32dc78d3
      - 71e44d7d313b4695a8bf51705f7adfc3
  condition: []
  action:
  - service: alarm_control_panel.alarm_disarm
    data:
      code: automation
    target:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1640431186550'
  alias: System - Count error in system log
  description: ''
  trigger:
  - platform: event
    event_type: system_log_event
    event_data:
      level: ERROR
  condition: []
  action:
  - service: counter.increment
    target:
      entity_id: counter.error_counter
    data: {}
  mode: queued
- id: '1641574319382'
  alias: Energy - Count Water Usage
  description: Count Water Usage through Esphome sensor
  use_blueprint:
    path: Techwolf12/watermeter.yaml
    input:
      counter: counter.watermeter_consumption_counter
      watermeterkit: sensor.water_meter_total_consumption
- id: '1642265273034'
  alias: Heating - Turn on heating main bedroom
  description: Turn on heating before schedule turns on
  trigger:
  - platform: time
    at: 09:55
  condition: []
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.shelly_plug_kachel_slaapkamer
  mode: single
- id: '1642265325725'
  alias: Heating - Turn off heating main bedroom
  description: Turn on heating after schedule turns off
  trigger:
  - platform: time
    at: '19:05'
  condition: []
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.shelly_plug_kachel_slaapkamer
  mode: single
- id: '1642502040367'
  alias: Heating - Control heating Eva
  description: This turns on the infra red heating panel in Eva's room
  use_blueprint:
    path: robsonke/heating.yaml
    input:
      heating: switch.infraroodpanel_eva
      temp_sensor: sensor.climate_sensor_eva_temperature
      min_temp: 17
      set_temp: 18
      time_after: 09:00:00
      time_before: '18:00:00'
      run_on_monday: true
      run_on_tuesday: true
      run_on_wednesday: true
      run_on_thursday: true
      run_on_friday: true
      run_on_saturday: true
      run_on_sunday: true
      window_sensor: binary_sensor.window_evaroom_openclose_sensor
      price_level_sensor: sensor.energy_price_level
      price_level_percentage: 90
- id: '1642502861762'
  alias: Heating - Control heating guestroom
  description: Enable the heating when Steffi works and few extra days
  use_blueprint:
    path: robsonke/heating.yaml
    input:
      heating: switch.kasa_infrarood_slaapkamer
      temp_sensor: sensor.climate_sensor_guestroom_temperature
      min_temp: 18
      set_temp: 18
      time_after: 07:00:00
      time_before: '17:30:00'
      run_on_monday: true
      run_on_tuesday: true
      run_on_wednesday: false
      run_on_thursday: true
      run_on_friday: false
      run_on_saturday: true
      run_on_sunday: false
      window_sensor: binary_sensor.window_guestroom_openclose_sensor
      price_level_sensor: sensor.energy_price_level
      price_level_percentage: 90
- id: '1642624564993'
  alias: Lights - Turn on lights when toilet door opens
  description: Check for an opening door or motion in toilet
  trigger:
  - platform: state
    entity_id: binary_sensor.toiletdoordownstairs_openclose
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.motion_sensor_toiletdownstairs_presence
    from: 'off'
    to: 'on'
  condition:
  - condition: device
    type: is_off
    device_id: 53ec925ec7a298678226212147f4562a
    entity_id: light.toilet_downstairs
    domain: light
  action:
  - service: light.turn_on
    data: {}
    target:
      device_id: 9518a5204c475eb1705f22684321c62c
  mode: single
- id: '1642625248443'
  alias: Lights - Turn off lights when toilet visit is over
  description: 'When there''s no more movement or '
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_sensor_toiletdownstairs_presence
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 20
      seconds: 0
  - platform: state
    entity_id: binary_sensor.toiletdoordownstairs_openclose
    from: 'on'
    to: 'off'
  condition:
  - condition: state
    entity_id: light.toilet_downstairs
    state: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 15
  action:
  - service: light.turn_off
    data:
      transition: 10
    target:
      entity_id: light.toilet_downstairs
  mode: restart
- id: '1642757425557'
  alias: Cast - Cast to Google Hub
  description: Doesn't work well right now, also button-cards are an issue
  use_blueprint:
    path: kind3r/cast-and-re-cast-a-lovelace-view-to-a-google-hub.yaml
    input:
      dashboard: main-dashboard
      player: media_player.keuken_display
      view: '0'
- id: '1643267142475'
  alias: Presence - Send message if cooker is still enabled and we left the house
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: zone.home
    above: '0'
    for:
      hours: 0
      minutes: 3
      seconds: 0
  condition:
  - condition: device
    type: is_on
    device_id: 4618f0919518ce4010cd4e0fa89fb474
    entity_id: switch.kookplaat_power
    domain: switch
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F468‍\U0001F373 We zijn allebei weg maar de kookplaat staat
        nog aan!"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1644162797655'
  alias: Heating - Control heating bedroom
  description: Turn on between 10h and 19h only when the temperature is too low and
    the windows are closed
  trigger:
  - platform: homeassistant
    event: start
  - platform: time_pattern
    minutes: /10
  - platform: state
    entity_id:
    - sensor.energy_price_level
  - platform: state
    entity_id:
    - binary_sensor.window_masterbed_1_openclose_sensor
    - binary_sensor.window_masterbed_2_openclose_sensor
  condition: []
  action:
  - choose:
    - conditions:
      - condition: time
        after: '10:00'
        before: '19:00'
      - condition: numeric_state
        entity_id: sensor.climate_sensor_masterbedroom_temperature
        below: '17'
      - type: is_not_open
        condition: device
        device_id: e495b09d382329f43540381dedb31f15
        entity_id: binary_sensor.window_masterbed_1_openclose_sensor
        domain: binary_sensor
      - type: is_not_open
        condition: device
        device_id: 83daade23505c1645165605bc56c49d1
        entity_id: binary_sensor.window_masterbed_2_openclose_sensor
        domain: binary_sensor
      - condition: numeric_state
        entity_id: sensor.energy_price_level
        attribute: percentage
        below: 91
        alias: The price should be low
      sequence:
      - device_id: 63bfcece97a8578bf632cddbc75ee61d
        domain: select
        entity_id: select.eurom_alutherm_capacity
        type: select_option
        option: Auto
      - service: climate.set_temperature
        data:
          hvac_mode: heat
          temperature: 19
        target:
          entity_id: climate.eurom_alutherm_baseboard_heater
    default:
    - device_id: 63bfcece97a8578bf632cddbc75ee61d
      domain: select
      entity_id: select.eurom_alutherm_capacity
      type: select_option
      option: 'Off'
  mode: single
- id: '1644692915726'
  alias: Garden - Turn off garden lights - evening
  description: Turn off lights in the garden in the evening but keep a few on on low
    brightness. Turn off when we go to bed, guest mode is off or otherwise at 23:00.
  trigger:
  - platform: time
    at: '23:00'
  - platform: state
    entity_id:
    - alarm_control_panel.alarmo
    to: armed_night
  condition:
  - condition: state
    entity_id: input_boolean.enable_automatic_garden_lights
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: time
    after: '22:59:00'
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_night
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_away
  action:
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.dimmer_cabinroof_level
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: light.turn_on
    data:
      brightness_pct: 20
    target:
      entity_id:
      - light.garden_lantern_light1
      - light.garden_lantern_light2
      - light.garden_lantern_light3
      - light.garden_light
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id: group.hue_lights_garden
  mode: single
- id: '1645647196286'
  alias: Windows - Masterbedroom1 open and low temperature
  description: ''
  use_blueprint:
    path: robsonke/window-open-temperature.yaml
    input:
      temp_sensor: sensor.climate_sensor_masterbedroom_temperature
      window_sensor: binary_sensor.window_masterbed_1_openclose_sensor
      min_temp: 15
      actions:
      - service: notify.all_phones
        data:
          message: "\U0001F3E0 Het raam in de slaapkamer staat open en het begint
            nu wel een beetje fris te worden."
          data:
            persistent: true
            tag: persistent
- id: '1645648583598'
  alias: Windows - Masterbedroom2 open and low temperature
  description: ''
  use_blueprint:
    path: robsonke/window-open-temperature.yaml
    input:
      temp_sensor: sensor.climate_sensor_masterbedroom_temperature
      window_sensor: binary_sensor.window_masterbed_2_openclose_sensor
      min_temp: 15
      actions:
      - service: notify.all_phones
        data:
          message: "\U0001F3E0 Het raam in de slaapkamer staat open en het begint
            nu wel een beetje fris te worden."
          data:
            persistent: true
            tag: persistent
- id: '1645648632551'
  alias: Windows - Eva open and low temperature
  description: ''
  use_blueprint:
    path: robsonke/window-open-temperature.yaml
    input:
      temp_sensor: sensor.climate_sensor_eva_temperature
      window_sensor: binary_sensor.window_evaroom_openclose_sensor
      min_temp: 15
      actions:
      - service: notify.all_phones
        data:
          message: "\U0001F3E0 Het raam bij Eva staat open en het begint nu wel een
            beetje fris te worden."
          data:
            persistent: true
            tag: persistent
- id: '1653419188796'
  alias: Irrigation - Always turn off after one hour
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.irrigation_zone_achter_links
    - switch.irrigation_zone_achter_rechts
    - switch.irrigation_zone_terras_zijkant
    - switch.irrigation_zone_terras_midden
    to: 'on'
    for:
      hours: 1
      minutes: 0
      seconds: 0
    from: 'off'
  condition: []
  action:
  - service: switch.turn_off
    target:
      entity_id: '{{ trigger.entity_id }}

        '
  mode: single
- id: '1653726752674'
  alias: Irrigation - Reset duration inputs once done
  description: Lets make sure the irrigation will not continue in 24 hours again.
  trigger:
  - platform: state
    entity_id:
    - sensor.zone_achter_rechts_resterende_tijd
    to: '0'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    id: achter-rechts
  - platform: state
    entity_id:
    - sensor.zone_achter_links_resterende_tijd
    to: '0'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    id: achter-links
  - platform: state
    entity_id:
    - sensor.zone_terras_midden_resterende_tijd
    to: '0'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    id: terras-midden
  - platform: state
    entity_id:
    - sensor.zone_terras_zijkant_resterende_tijd
    to: '0'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    id: terras-zijkant
  condition: []
  action:
  - if:
    - condition: trigger
      id: achter-rechts
    then:
    - service: input_number.set_value
      data:
        value: 0
      target:
        entity_id: input_number.irrigation_zone_achter_rechts_duration
  - if:
    - condition: trigger
      id: achter-links
    then:
    - service: input_number.set_value
      data:
        value: 0
      target:
        entity_id: input_number.irrigation_zone_achter_links_duration
  - if:
    - condition: trigger
      id: terras-midden
    then:
    - service: input_number.set_value
      data:
        value: 0
      target:
        entity_id: input_number.irrigation_zone_terras_midden_duration
  - if:
    - condition: trigger
      id: terras-zijkant
    then:
    - service: input_number.set_value
      data:
        value: 0
      target:
        entity_id: input_number.irrigation_zone_terras_zijkant_duration
  mode: single
- id: '1655029746074'
  alias: Switch - Control office light hue switch
  description: ''
  use_blueprint:
    path: hugalafutro/Z2M_Hue_Dimmer_Switch_v2.yaml
    input:
      dimmer_action: zigbee2mqtt/dimmer_switch_office/action
      action_on_press:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.office_lights
      action_off_press:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.office_lights
      action_up_press:
      - service: light.turn_on
        data_template:
          entity_id: light.office_lights
          brightness: '{% set bri = state_attr(''light.office_lights'', ''brightness'')
            | int %} {{ [bri+30, 249] | min }}

            '
      action_down_press:
      - service: light.turn_on
        data_template:
          entity_id: light.office_lights
          brightness: '{% set bri = state_attr(''light.office_lights'', ''brightness'')
            | int %} {{ [bri-30, 249] | min }}

            '
      action_on_hold:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.office_lights
      action_off_hold:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.office_lights
      action_up_hold:
      - service: light.turn_on
        data_template:
          entity_id: light.office_lights
          brightness: '{% set bri = state_attr(''light.office_lights'', ''brightness'')
            | int %} {{ [bri+30, 249] | min }}

            '
      action_down_hold:
      - service: light.turn_off
        data_template:
          entity_id: light.office_lights
          brightness: '{% set bri = state_attr(''light.office_lights'', ''brightness'')
            | int %} {{ [bri-30, 249] | min }}

            '
- id: '1657445203959'
  alias: System - Restart armcrest addon
  description: ''
  trigger:
  - platform: time
    at: 01:00:00
  condition: []
  action:
  - service: hassio.addon_restart
    data:
      addon: c0d67ef2_amcrest2mqtt
  mode: single
- id: '1659861088978'
  alias: Screens - Close screens zijraam on warm sunny days
  description: In case it's warm and sunny, close the screens in the morning but the
    one on the side a bit later
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.openweathermap_forecast_temperature
          above: '20'
        - condition: numeric_state
          entity_id: sensor.openweathermap_forecast_cloud_coverage
          below: '80'
      - condition: numeric_state
        entity_id: sensor.openweathermap_forecast_temperature
        above: '22'
    - condition: device
      device_id: 7a674f956b15af8decebb36355772928
      domain: cover
      entity_id: cover.zijraam
      type: is_open
  - condition: time
    after: '11:00:00'
    before: '19:00:00'
  - condition: state
    entity_id: sensor.rate_rain_piezo
    state: '0.0'
  - condition: state
    entity_id: input_boolean.enable_automatic_screens
    state: 'on'
  action:
  - service: notify.all_phones
    data:
      message: ☀️ De screens aan de zijkant gaan dicht
      data:
        persistent: true
        tag: persistent
  - service: cover.close_cover
    data: {}
    target:
      entity_id: cover.zijraam
  mode: single
- id: '1659880318627'
  alias: DHW - Enable warm water heating
  description: Enable the heatpump based on need and energy pricing
  trigger:
  - platform: numeric_state
    entity_id: sensor.energy_price_level
    attribute: percentage
    below: '91'
  - platform: numeric_state
    entity_id: water_heater.domestic_hot_water_tank
    attribute: current_temperature
    below: '35'
  - platform: time_pattern
    minutes: /30
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: sensor.energy_price_level
        attribute: percentage
        below: '91'
      - condition: numeric_state
        entity_id: water_heater.domestic_hot_water_tank
        attribute: current_temperature
        below: '40'
        above: '0'
    - condition: numeric_state
      entity_id: water_heater.domestic_hot_water_tank
      attribute: current_temperature
      below: '32'
      above: '0'
  - condition: state
    entity_id: water_heater.domestic_hot_water_tank
    attribute: operation_mode
    state: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
  - condition: numeric_state
    entity_id: sensor.energy_price_level
    attribute: percentage
    below: '116'
  action:
  - service: water_heater.set_temperature
    data:
      temperature: 45
    target:
      entity_id: water_heater.domestic_hot_water_tank
  - service: water_heater.set_operation_mode
    data:
      operation_mode: 'on'
    target:
      entity_id: water_heater.domestic_hot_water_tank
  trace:
    stored_traces: 50
  mode: single
- id: '1659881596095'
  alias: DHW - Disable warm water heating
  description: Disable the heatpump based on need and energy pricing. Also lower the
    expected temperature to avoid the pump itself decides to turn on.
  trigger:
  - platform: numeric_state
    entity_id: sensor.energy_price_level
    attribute: percentage
    above: '115'
  - platform: state
    entity_id:
    - water_heater.domestic_hot_water_tank
    attribute: current_temperature
  - platform: state
    entity_id:
    - water_heater.domestic_hot_water_tank
    attribute: temperature
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.energy_price_level
      attribute: percentage
      above: '115'
    - condition: template
      value_template: '{{ state_attr(''water_heater.domestic_hot_water_tank'',''current_temperature'')
        | float >= state_attr(''water_heater.domestic_hot_water_tank'',''temperature'')
        | float }}'
  - condition: numeric_state
    entity_id: water_heater.domestic_hot_water_tank
    attribute: current_temperature
    above: '40'
  - condition: state
    entity_id: water_heater.domestic_hot_water_tank
    attribute: operation_mode
    state: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 0
  action:
  - service: water_heater.set_temperature
    data:
      temperature: 30
    target:
      entity_id: water_heater.domestic_hot_water_tank
  - service: water_heater.set_operation_mode
    data:
      operation_mode: 'off'
    target:
      entity_id: water_heater.domestic_hot_water_tank
  trace:
    stored_traces: 10
  mode: single
- id: '1661801771945'
  alias: System - Refresh wall tablet
  description: After a restart or frontend changes, force a refresh
  trigger:
  - platform: event
    event_type: lovelace_updated
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: browser_mod.refresh
    data:
      browser_id: 65b403f4-fb734e3d
  mode: single
- id: '1661977922126'
  alias: HVAC - Control Operation Mode downstairs
  description: 'Set the HVAC mode (heat/cool/off) for the heat pump. By default off,
    cooling when it is expected to be hot outside and also becoming hotter inside,
    heating when the indoor temperature is low and outside also getting cooler.

    This still doesn''t mean that the pump would start, it will still use its indoor
    sensors. And even when it does turn on, other automations might stop that, based
    on the heating and cooling input booleans.'
  trigger:
  - platform: state
    entity_id:
    - sensor.downstairs_temperature
  condition: []
  action:
  - choose:
    - conditions:
      - alias: Confirm if the temperature is below the minimum allowed temperature
        condition: template
        value_template: '{{ states(''sensor.downstairs_temperature'') < states(''input_number.hvac_heating_limit'')
          }}'
      - condition: numeric_state
        entity_id: sensor.today_maximum_temperature
        below: 18
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.warmtepomp
          attribute: hvac_action
          state: heating
        alias: Action should not be set to heating already
      sequence:
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.warmtepomp
        data:
          hvac_mode: heat
        alias: Set HVAC to heating
      - service: select.select_option
        data:
          option: heating
        target:
          entity_id: select.operation_mode
    - conditions:
      - alias: Confirm if the temperature is below the maximum and above the minimum
          allowed temperature
        condition: template
        value_template: '{{ states(''sensor.downstairs_temperature'') < states(''input_number.hvac_cooling_limit'')
          and states(''sensor.downstairs_temperature'') > states(''input_number.hvac_heating_limit'')
          }}'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.warmtepomp
          attribute: hvac_action
          state: 'off'
      sequence:
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.warmtepomp
        data:
          hvac_mode: 'off'
        alias: Turn HVAC off
    - conditions:
      - alias: Confirm if the temperature is above the maximum allowed temperature
        condition: template
        value_template: '{{ states(''sensor.downstairs_temperature'') > states(''input_number.hvac_cooling_limit'')
          }}'
      - condition: numeric_state
        entity_id: sensor.today_maximum_temperature
        above: '26'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.warmtepomp
          attribute: hvac_action
          state: cooling
        alias: Action should not be set to cooling already
      sequence:
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.warmtepomp
        data:
          hvac_mode: cool
        alias: Set HVAC to cooling
      - service: select.select_option
        data:
          option: cooling
        target:
          entity_id: select.operation_mode
  trace:
    stored_traces: 20
  mode: queued
  max: 3
- id: '1662038485202'
  alias: System - Control the wallpanel screensaver mode during the night
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.night_mode
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.night_mode
        state: 'on'
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.wallpanel_screensaver_enabled
    default:
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.wallpanel_screensaver_enabled
  mode: single
- id: '1662889733680'
  alias: Screens - Disable the automatic control of the screens in case of a manual
    action
  description: ''
  trigger:
  - platform: state
    entity_id:
    - cover.voorraam
    - cover.zijraam
    alias: When the position of the screens change
    attribute: current_position
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ trigger.to_state.context.parent_id == none }}'
    - condition: template
      value_template: '{{ trigger.to_state.context.user_id == none }}'
      enabled: true
    - condition: template
      value_template: '{{ trigger.to_state.context.id != none }}'
    alias: Only in case of a manual user interaction
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.enable_automatic_screens
    alias: Disable the automatic screens control for today
  mode: single
- id: '1663352793600'
  alias: System - Alert when the shed fridge is off too long
  description: ''
  use_blueprint:
    path: robsonke/device-off-warning.yaml
    input:
      switch: switch.shelly_plug_s_8_fridge1_relay
      max_time_off: 30
      actions:
      - service: notify.all_phones
        data:
          message: "\U0001F9CA Let op, de vriezer in de schuur staat al een half uur
            uit!"
          data:
            persistent: true
            tag: persistent
- id: '1663352887163'
  alias: System - Alert when the kitchen cooling is off too long
  description: ''
  use_blueprint:
    path: robsonke/device-off-warning.yaml
    input:
      switch: switch.shelly_plug_koelkast_relay
      max_time_off: 30
      actions:
      - service: notify.all_phones
        data:
          message: "\U0001F9CA Let op, de koelkast staat al een half uur uit!"
          data:
            persistent: true
            tag: persistent
- id: '1663353341942'
  alias: System - Alert in case of heavy water usage in one day
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.water_daily
  condition:
  - condition: numeric_state
    entity_id: sensor.water_daily
    above: 5
  action:
  - service: notify.all_phones
    data:
      message: "\U0001F4A6 Let op, we hebben vandaag al meer dan 5 kuub water verbruikt!"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1663403485592'
  alias: HVAC - Set default temperature
  description: This sets the temperature based on the heating or cooling mode plus
    the hvac scheduler (lower effort in the night). Overall, heatpumps better have
    some kind of default minimum, so we never go below 18 degrees
  trigger:
  - platform: state
    entity_id:
    - schedule.hvac_schedule
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.hvac_schedule
        state: 'on'
      - condition: state
        entity_id: select.operation_mode
        state: heating
      sequence:
      - service: climate.set_temperature
        data_template:
          temperature: '{{ states(''input_number.hvac_winter_target_temperature'')
            | float }}'
        target:
          entity_id: climate.warmtepomp
        alias: Heat - Set temperature to 21 degrees during the day
    - conditions:
      - condition: state
        entity_id: schedule.hvac_schedule
        state: 'off'
      - condition: state
        entity_id: select.operation_mode
        state: heating
      sequence:
      - service: climate.set_temperature
        data:
          temperature: 18
        target:
          entity_id: climate.warmtepomp
        alias: Heat - Set temperature to 18 degrees during the night
    - conditions:
      - condition: state
        entity_id: schedule.hvac_schedule
        state: 'on'
      - condition: state
        entity_id: select.operation_mode
        state: cooling
      sequence:
      - service: climate.set_temperature
        data_template:
          temperature: '{{ states(''input_number.hvac_summer_target_temperature'')
            | float }}'
        target:
          entity_id: climate.warmtepomp
        alias: Cool - Set temperature to 23 degrees during the day
    - conditions:
      - condition: state
        entity_id: schedule.hvac_schedule
        state: 'off'
      - condition: state
        entity_id: select.operation_mode
        state: cooling
      sequence:
      - service: climate.set_temperature
        data:
          temperature: 25
        target:
          entity_id: climate.warmtepomp
        alias: Cool - Set temperature to 25 degrees during the night
    alias: Set the right target temperature, depending on day/night and season
  trace:
    stored_traces: 20
  mode: single
- id: '1663405385606'
  alias: HVAC - Control the heatpump
  description: This controls whether the heatpump should be turned on or not. Based
    on pricing or potential PV over capacity (later). So far, using the price works
    oke, the higher the price, the more need there is for power, so the less we do.
  trigger:
  - platform: state
    entity_id:
    - sensor.energy_price_level
  - platform: state
    entity_id:
    - input_boolean.heating_downstairs
    - input_boolean.cooling_downstairs
  - platform: state
    entity_id:
    - climate.warmtepomp
  condition:
  - condition: state
    entity_id: input_boolean.enable_automatic_hvac
    state: 'on'
    alias: Only dis/enable the heappump when the automation is active
  - condition: template
    value_template: '{{ trigger.from_state.state != "unavailable" and trigger.to_state.state
      != "unavailable" }}'
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: sensor.cheapest_8_hours_24h
          state: 'True'
          alias: Is this one of the 8 cheapest hours of the day
        - condition: numeric_state
          entity_id: sensor.energy_price_level
          attribute: percentage
          below: 91
          alias: Or in case the price is low, probably giving the same result
        alias: Check if the price is oke
      - condition: not
        alias: Only when we are in heating or cooling mode
        conditions:
        - condition: state
          entity_id: climate.warmtepomp
          attribute: hvac_action
          state: 'off'
      sequence:
      - service: switch.turn_on
        data: {}
        target:
          entity_id: switch.climate_control
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: switch.climate_control
          state: 'off'
      sequence:
      - service: switch.turn_off
        data: {}
        target:
          entity_id: switch.climate_control
    default: []
    alias: Turn on when needed and the price is oke, otherwise default off
  trace:
    stored_traces: 20
  mode: single
  max_exceeded: silent
- id: '1663492219970'
  alias: Presence - Disable Guest Mode when one of us comes home
  description: To avoid we forget to turn it off
  trigger:
  - platform: state
    for:
      seconds: 15
    entity_id:
    - device_tracker.rob_presence
    - device_tracker.steffi_presence
    to: just_arrived
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: person.rob
      state: home
    - condition: state
      entity_id: person.steffi
      state: home
  - condition: state
    state: 'on'
    entity_id: input_boolean.guest_mode
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.guest_mode
  - service: notify.all_phones
    data:
      message: ⏰ Een van ons komt thuis, gast modus gaat nu uit
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1663526481065'
  alias: Heating - Control heaters bathrooms
  description: Turn simply on/off the heaters in both bathrooms. These are stupid
    devices with their own local thermostat, so we just turn them on to dry towells.
  trigger:
  - platform: time
    at: 09:00:00
  - platform: time
    at: '22:00:00'
  condition:
  - condition: numeric_state
    entity_id: sensor.today_maximum_temperature
    below: 14
    alias: Today Maximum Temperature Outside is below 18 degrees
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id:
      - switch.shelly_plug_douche_verwarming_relay
      - switch.shelly_plug_badkamer_verwarming_relay
  - delay:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: switch.turn_off
    data: {}
    target:
      entity_id:
      - switch.shelly_plug_badkamer_verwarming_relay
      - switch.shelly_plug_douche_verwarming_relay
  mode: single

- id: '1618070798660'
  alias: Battery - Low battery level detection & notification for all battery sensors
  description: Low battery level detection & notification for all battery sensors
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      time: '10:00:00'
      actions:
      - action: notify.mobile_app_iphone_rob
        data:
          message: "\U0001F50B Low battery warning for {{sensors|replace(\"_\",\"
            \")}}"
          data:
            persistent: true
            tag: persistent
      - action: persistent_notification.create
        metadata: {}
        data:
          title: Battery low
          message: "\U0001F50B Low battery warning for {{sensors|replace(\"_\",\"
            \")}}"
- id: alarm_auto_arm_when_away
  alias: Alarm - Auto arm since we're away and all is closed
  description: We didn't enable the Guest mode and we both left, arm the house
  trigger:
  - trigger: numeric_state
    entity_id: zone.home
    for:
      hours: 0
      minutes: 3
      seconds: 0
    below: '1'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: disarmed
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - data:
      message: ⏰ We zijn beiden weg, het alarm wordt geactiveerd
      data:
        persistent: true
        tag: persistent
    action: notify.all_phones
  - target:
      entity_id: alarm_control_panel.alarmo
    data: {}
    action: alarm_control_panel.alarm_arm_away
  mode: single
- id: alarm_auto_disarm_when_arriving
  alias: Alarm - Disarm automatically when one of us comes home
  description: Automatically disarm when we come home
  triggers:
  - entity_id:
    - person.rob
    - person.steffi
    to: home
    for: 0:00:30
    trigger: state
  - entity_id: device_tracker.ix3
    to: home
    from: not_home
    trigger: state
  conditions:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: armed_away
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: armed_home
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: pending
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: triggered
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: arming
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  actions:
  - action: notify.all_phones
    data:
      message: ⏰ Een van ons komt thuis, het alarm wordt gedeactiveerd.
      data:
        persistent: true
        tag: persistent
  - action: alarm_control_panel.alarm_disarm
    data:
      code: automation
    target:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: alarm_trigger_when_armed_away
  alias: Alarm - Trigger when door and window status change
  description: Change the alarm state to triggering when an important door or window
    opens
  trigger:
  - trigger: state
    entity_id: sensor.doors_windows_open_count
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.state | int > trigger.from_state.state |
      int }}'
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: armed_away,armed_home,armed_night
  action:
  - action: alarm_control_panel.alarm_trigger
    entity_id: alarm_control_panel.alarmo
  mode: single
- id: alarm_triggered_alert
  alias: Alarm - Triggered BEEP BEEP BEEP
  description: Now we are in trouble, the alarm is triggered and we have not disarmed
    it. A lot of noise and lights will be activated.
  trigger:
  - trigger: state
    entity_id: alarm_control_panel.alarmo
    to: triggered
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F6A8\U0001F6A8 ALARM! Het alarm gaat af en is te laat gedeactiveerd!
        \U0001F6A8\U0001F6A8"
      data:
        persistent: true
        tag: persistent
        push:
          sound: alarm.caf
          critical: 1
          volume: 1
          interruption-level: critical
        actions:
        - action: URI
          title: Bekijk cams
          uri: /lovelace/4
        - action: SILENCE_ALARM
          title: Alarm uit
          icon: sfsymbols:bell.slash
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.alarm_active
  - repeat:
      while:
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: triggered
      - condition: template
        value_template: '{{ repeat.index <= 20 }}'
      sequence:
      - data:
          sonos_entity: media_player.eetkamer
          volume: 30
          message: Je bent gezien en wordt nu gefilmd!
        action: script.sonos_say
      - action: script.sonos_play_sound
        data:
          mp3_url: https://home.tigrou.nl/local/sounds/alarm2.mp3
          volume: 40
          sonos_entity: media_player.living_room
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.alarm_active
  mode: single
- id: alarm_pending_trigger
  alias: Alarm - Pending
  description: Warn the person that walked in about the armed alarm, goal is to disarm
    asap
  trigger:
  - trigger: state
    entity_id: alarm_control_panel.alarmo
    to: pending
  action:
  - data:
      sonos_entity: media_player.eetkamer
      volume: 20
      message: Je bent gezien, deactiveer het alarm binnen 2 minuten!
    action: script.sonos_say
  - data:
      title: Alarm actief
      content:
        type: custom:alarmo-card
        entity: alarm_control_panel.alarmo
    action: browser_mod.popup
  - repeat:
      while:
      - condition: state
        entity_id: alarm_control_panel.alarmo
        state: pending
      - condition: template
        value_template: '{{ repeat.index <= 10 }}'
      sequence:
      - data:
          mp3_url: https://home.tigrou.nl/local/sounds/pending_alarm.mp3
          volume: 40
          sonos_entity: media_player.living_room
        action: script.sonos_play_sound
- id: alarm_disarm_correctly
  alias: Alarm - Disarmed
  description: Send a message that the alarm is properly disarmed and inform the person
    over speakers
  trigger:
  - trigger: state
    entity_id: alarm_control_panel.alarmo
    from: triggered,pending
    to: disarmed
  action:
  - action: notify.all_phones
    data:
      message: '✅ ALARM: Het alarm is uitgezet.'
      data:
        persistent: true
        tag: persistent
  - action: script.sonos_say
    data:
      sonos_entity: media_player.eetkamer
      volume: 20
      message: Het alarm is uitgeschakeld
  mode: single
- id: reset_lights_automation
  alias: Lights - Reset lights automation
  description: When we have disabled all automatic lighting, we reset this in the
    early morning to make sure we're back to normal the next day
  trigger:
  - trigger: time
    at: 05:00:00
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.enable_automatic_garden_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.enable_automatic_screens
      state: 'off'
  action:
  - action: input_boolean.turn_on
    entity_id: input_boolean.enable_automatic_lights
  - action: input_boolean.turn_on
    entity_id: input_boolean.enable_automatic_garden_lights
- id: groundfloor_lights_on_when_dark_away
  alias: Lights - Turn on lights when dark - away
  description: Switch standard lights on when it's after 2 PM and light level too
    low
  trigger:
  - trigger: numeric_state
    entity_id: sensor.light_sensor_living_illuminance_lux
    below: '30'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: light.socket2_light_couch
      state: 'off'
    - condition: time
      after: '14:00'
      before: '22:30'
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'on'
    - condition: state
      entity_id: zone.home
      state: '0'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - action: script.lights_on_away
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  mode: single
- id: groundfloor_lights_on_when_dark_home
  alias: Lights - Turn on lights when dark - home
  description: Switch standard lights on when it's after 2 PM and light level too
    low
  trigger:
  - trigger: numeric_state
    entity_id:
    - sensor.light_sensor_living_illuminance_lux
    below: '30'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  condition:
  - condition: and
    conditions:
    - condition: time
      after: '10:00'
      before: '22:30'
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'on'
    - condition: state
      entity_id: binary_sensor.template_people_home_and_awake
      state: 'on'
  - condition: device
    device_id: 29fa064f108236608f9f0d8f063dbc17
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: is_disarmed
  action:
  - action: script.lights_on_home
    data: {}
  - delay: '1'
  mode: single
- id: backup_snapshots_stale
  alias: Backup - Snapshots went stale
  description: Send a push message when the backups are failing
  trigger:
  - trigger: state
    entity_id: binary_sensor.snapshots_stale
    from: 'False'
    to: 'True'
  condition: []
  action:
  - action: persistent_notification.create
    data:
      title: "\U0001F6A8\U0001F6A8 Snapshots are Stale \U0001F6A8\U0001F6A8"
      message: Please visit the Hass.io Google Drive Backup add-on status page for
        details.
- id: calendar_trash_alert
  alias: Calendar - Afval Calendar Alert
  description: Send messages when a trash bin should be put outside
  trigger:
  - entity_id: sensor.template_gft_days_until_collection
    trigger: state
    to: '1'
    for:
      hours: 20
      minutes: 0
      seconds: 0
  - entity_id: sensor.template_rest_days_until_collection
    trigger: state
    to: '1'
    for:
      hours: 20
      minutes: 0
      seconds: 0
  - entity_id: sensor.template_paper_days_until_collection
    trigger: state
    to: '0'
    for:
      hours: 16
      minutes: 0
      seconds: 0
  action:
  - action: notify.all_phones
    data_template:
      message: "\U0001F4C5  Opletten {{ state_attr(trigger.entity_id, 'friendly_name')
        }}!"
      data:
        persistent: true
        tag: persistent
- id: doorbell_ring_notification
  alias: Doorbell - Notification Doorbell Ring
  description: Say ding dong through the speakers when doorbell rings
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.langeweide_doorbell_visitor
    from: 'off'
    to: 'on'
  action:
  - parallel:
    - action: script.sonos_play_sound
      data:
        volume: 30
        sonos_entity: media_player.eetkamer
        mp3_url: https://home.tigrou.nl/local/sounds/doorbell2.mp3
    - action: script.sonos_play_sound
      data:
        volume: 30
        sonos_entity: media_player.woonkamer
        mp3_url: https://home.tigrou.nl/local/sounds/doorbell2.mp3
  - condition: time
    after: 06:00:00
    before: '22:00:00'
  - action: script.sonos_play_sound
    data:
      volume: 20
      sonos_entity: media_player.slaapkamer_sonos
      mp3_url: https://home.tigrou.nl/local/sounds/doorbell2.mp3
- id: garden_lights_turn_on
  alias: Garden - Turn on garden lights
  description: When it's getting dark and at least after 4 PM, turn on lights in the
    garden
  triggers:
  - entity_id:
    - sensor.light_sensor_garden_illuminance_lux
    below: 8
    trigger: numeric_state
  - at: 07:00
    trigger: time
  - entity_id: sun.sun
    attribute: elevation
    below: '-3'
    trigger: numeric_state
  conditions:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: time
        after: '16:00'
      - condition: time
        before: '22:55'
      - condition: state
        entity_id: input_boolean.enable_automatic_garden_lights
        state: 'on'
      - condition: state
        entity_id: light.hue_lily_light_fence_1
        state: 'off'
    - alias: In the morning it should be dark enough and not just turned off by the
        other automation
      condition: and
      conditions:
      - condition: time
        after: 06:15
      - condition: time
        before: 08:55
      - condition: state
        entity_id: input_boolean.enable_automatic_garden_lights
        state: 'on'
      - condition: state
        entity_id: light.hue_lily_light_fence_1
        state: 'off'
      - condition: state
        entity_id: light.garden_lantern_light1
        state: 'on'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.light_sensor_living_illuminance_lux
          below: 8
        - condition: numeric_state
          entity_id: sun.sun
          attribute: elevation
          below: '-4'
  - condition: state
    entity_id: light.hue_lily_light_fence_1
    state: 'off'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  actions:
  - action: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id:
      - light.garden_light
  - action: light.turn_on
    target:
      entity_id:
      - light.kerst_buiten
  - action: light.turn_on
    data:
      kelvin: 2200
    target:
      entity_id:
      - light.palm1_light
      - light.palm2_light
  - action: light.turn_on
    data:
      brightness_pct: 6
    target:
      entity_id: light.woodshed_light
  - action: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id: light.garden_lantern_light1
  - action: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id: light.garden_lantern_light2
  - action: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id: light.garden_lantern_light3
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - action: light.turn_on
    data:
      brightness_pct: 35
    target:
      entity_id: light.veranda_light
  - action: light.turn_on
    data:
      kelvin: 2200
    target:
      entity_id: light.hue_lights_garden
  mode: single
- id: garden_lights_turn_off
  alias: Garden - Turn off garden lights - morning
  description: Turn off lights in the garden in the morning
  triggers:
  - at: 09:00
    trigger: time
  - entity_id:
    - sensor.light_sensor_garden_illuminance_lux
    above: 5
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: input_boolean.enable_automatic_garden_lights
    state: 'on'
  actions:
  - action: light.turn_off
    data: {}
    target:
      entity_id:
      - light.veranda_light
      - light.hue_lights_garden
      - light.woodshed_light
      - light.palm1_light
      - light.palm2_light
      - light.kerst_buiten
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - action: light.turn_off
    data: {}
    target:
      entity_id:
      - light.garden_lantern_light1
      - light.garden_lantern_light2
      - light.garden_lantern_light3
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - action: light.turn_off
    data: {}
    target:
      entity_id:
      - light.garden_light
  mode: single
- id: lights_turn_off_bedtime_manual
  alias: Sleep - Switch to night mode manually
  description: Go to bed switch, turn off all we don't need during the night. Lights,
    music, tv, etc. And turn on the alarm
  triggers:
  - entity_id:
    - alarm_control_panel.alarmo
    from: disarmed
    to: armed_night
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: time
      after: '21:00:00'
    - condition: time
      before: 05:00
  actions:
  - parallel:
    - action: script.sleep_well
      data: {}
    - sequence:
      - action: light.turn_on
        data:
          brightness_pct: 30
        target:
          entity_id: light.dimmer_hall
      - delay:
          hours: 0
          minutes: 0
          seconds: 15
          milliseconds: 0
      - action: light.turn_off
        target:
          entity_id: light.dimmer_hall
        data: {}
      alias: Turn on hall light shortly
  - alias: Turn off the couch and corner light too if it's after 11 pm
    condition: or
    conditions:
    - condition: time
      after: '22:55:00'
    - condition: time
      after: 00:00:00
      before: 05:00:00
  - action: light.turn_off
    target:
      entity_id:
      - light.socket1_light_corner
      - light.socket2_light_couch
    data: {}
  mode: single
- id: lights_turn_off_bedtime_auto
  alias: Lights - Turn off lights automatically - bedtime
  description: Turn off main lights when we're not home or already went to bed
  trigger:
  - trigger: time_pattern
    minutes: /1
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: light.socket2_light_couch
      state: 'on'
    - condition: time
      after: '23:03'
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'on'
    - condition: state
      entity_id: zone.home
      state: '0'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - action: script.sleep_well
    data: {}
  - action: light.turn_off
    target:
      entity_id:
      - light.socket1_light_corner
      - light.socket2_light_couch
  mode: single
- id: closet_light_turn_on
  alias: Lights - Turn on lights when closet door opens
  trigger:
  - trigger: state
    entity_id: binary_sensor.door_hallcloset_openclose_contact
    from: 'off'
    to: 'on'
  action:
  - action: light.turn_on
    data: {}
    target:
      entity_id: light.hallcloset_light
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.door_hallcloset_openclose_contact
      from: 'on'
      to: 'off'
  - action: light.turn_off
    data: {}
    target:
      entity_id: light.hallcloset_light
- id: lights_kitchen_turn_on_when_awake_morning
  alias: Lights - Turn on lights when hallway door opens in the early morning
  triggers:
  - entity_id: binary_sensor.hallwaydoor_openclose_contact
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: time
    after: 04:00
    before: '11:00:00'
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: armed_night
    for:
      hours: 0
      minutes: 10
      seconds: 0
  actions:
  - action: alarm_control_panel.alarm_disarm
    data:
      code: automation
    target:
      entity_id: alarm_control_panel.alarmo
  - choose:
    - conditions:
      - condition: time
        after: 06:00
      - condition: numeric_state
        entity_id: zone.home
        above: '0'
      sequence:
      - action: media_player.media_play
        data: {}
        target:
          entity_id: media_player.eetkamer
  - condition: numeric_state
    entity_id: sensor.light_sensor_living_illuminance_lux
    below: '60'
  - action: light.turn_on
    data:
      brightness_pct: 40
    target:
      entity_id:
      - light.kitchendesk_light
      - light.diningtable_light
  - action: light.turn_on
    target:
      entity_id:
      - light.kerst_binnen
  mode: single
- id: restart_ssh_addon
  alias: Hass - Restart SSH Addon
  description: Restart the ssh addon after a HA restart, required to get the hassio.addon_stdin
    to work
  trigger:
  - trigger: homeassistant
    event: start
  - trigger: time
    at: 01:00:00
  action:
  - delay: 00:04
  - action: hassio.addon_restart
    data:
      addon: a0d7b954_ssh
  - delay: 00:01
  - action: hassio.addon_stdin
    data:
      addon: a0d7b954_ssh
      input: bash /config/cast.sh
  mode: single
- alias: System - Let's Encrypt Renewal
  id: system_lets_encrypt
  description: Restart the lets encrypt addon, this should renew the certificate
  trigger:
    trigger: time
    at: 01:15:00
  action:
  - action: hassio.addon_restart
    data:
      addon: core_letsencrypt
- alias: Lights - Check if automatic lights are disabled by accident
  id: lights_reset_disabled_accidentally
  description: Check every hour if this wasn't done by accident
  trigger:
    trigger: time_pattern
    hours: /1
  condition:
    condition: and
    conditions:
    - condition: time
      after: 05:30:00
      before: '20:30:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.enable_automatic_lights
        state: 'off'
      - condition: state
        entity_id: input_boolean.enable_automatic_garden_lights
        state: 'off'
  action:
  - action: persistent_notification.create
    data:
      title: Verlichting
      message: De automatische verlichting is uitgeschakeld, dit is mogelijk onbewust.
- id: presence_detection_message_speakers
  alias: Presence - Inform that one of us comes home
  description: Shout through speakers that somebody is arriving when the other one
    is home
  trigger:
  - trigger: state
    for:
      seconds: 15
    entity_id:
    - person.rob
    - person.steffi
    to: home
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: person.rob
      state: home
    - condition: state
      entity_id: person.steffi
      state: home
  - condition: state
    state: 'off'
    entity_id: input_boolean.guest_mode
  action:
  - action: script.sonos_say
    data_template:
      sonos_entity: media_player.eetkamer
      volume: 30
      message: Wakker worden, {{ state_attr(trigger.entity_id, 'friendly_name') }}
        komt er aan!
  - delay: '2'
  mode: single
- id: presence_frigate_object_detection
  alias: Alarm - Notify of person events on camera
  trigger:
  - trigger: mqtt
    topic: frigate/events
  condition:
  - condition: or
    conditions:
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_night
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_away
  - condition: template
    value_template: '{{ trigger.payload_json[''after''][''label''] == ''person'' }}'
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.presence_notify_of_events_in_frigate.attributes.last_triggered,
      0) | int > 120 }}'
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''achterdeur''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''terras''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''veranda''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''bijkeuken''
        }}'
  action:
  - action: notify.all_phones
    data_template:
      message: Er is een {{trigger.payload_json["after"]["label"]}} gedetecteerd op
        de {{ trigger.payload_json["after"]["camera"] }} camera
      data:
        persistent: true
        image: https://home.tigrou.nl/api/frigate/notifications/{{trigger.payload_json["after"]["id"]}}/thumbnail.jpg
        tag: '{{trigger.payload_json["after"]["id"]}}'
        when: '{{trigger.payload_json["after"]["start_time"]|int}}'
        entity_id: camera.{{trigger.payload_json["after"]["camera"]}}
  mode: single
- alias: Theme - Switch to dark mode
  id: theme_switch_dark
  trigger:
  - trigger: time
    at: '22:00:00'
  - trigger: sun
    event: sunset
  condition: '{{ is_state(''input_boolean.dark_mode'', ''off'') }}'
  action:
    entity_id: input_boolean.dark_mode
    action: input_boolean.turn_on
- alias: Theme - Switch to light mode
  id: theme_switch_light
  trigger:
  - trigger: time
    at: 09:00:00
  - trigger: sun
    event: sunrise
  condition: '{{ is_state(''input_boolean.dark_mode'', ''on'') }}'
  action:
    entity_id: input_boolean.dark_mode
    action: input_boolean.turn_off
- id: theme_switch_manually
  alias: Theme - Change theme manually
  trigger:
  - trigger: state
    entity_id: input_boolean.dark_mode
  action:
  - action: browser_mod.set_theme
    data_template:
      theme: custom-dark
      dark: "{% if is_state(\"input_boolean.dark_mode\", \"on\") %}\n  dark\n{% else
        %}\n  light\n{% endif %}\n"
- id: lovelace_convert_json_yaml
  alias: Lovelace - convert lovelace.json to lovelace-ui.yaml
  trigger:
  - trigger: state
    entity_id: sensor.lovelace_size
  action:
  - action: shell_command.convert_lovelace
    data: {}
- id: sjorsje_bin_full
  alias: Vacuum - Sjorsje Bin Full
  trigger:
  - entity_id: binary_sensor.sjorsje_bin_full
    trigger: state
    to: 'on'
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F9F9 Sjorsje's opvangbak zit vol"
      data:
        persistent: true
        tag: persistent
  - action: persistent_notification.create
    data:
      title: Opvangbak Sjorsje
      message: "\U0001F9F9 Sjorsje's opvangbak zit vol"
- alias: Vacuum - Sjorsje Battery Empty
  id: sjorsje_battery_empty
  trigger:
  - entity_id: sensor.sjorsje_battery_level
    trigger: numeric_state
    below: 20
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F50B Sjorsje's accu raakt leeg"
      data:
        persistent: true
        tag: persistent
  - action: persistent_notification.create
    data:
      title: Accu Sjorsje
      message: "\U0001F50B Sjorsje's accu raakt leeg"
- id: '1618732336311'
  alias: Dishwasher - Dishwasher ready
  description: ''
  use_blueprint:
    path: sbyx/notify-or-do-something-when-an-appliance-like-a-dishwasher-or-washing-machine-finishes.yaml
    input:
      power_sensor: sensor.vaatwasser_switch_current_consumption
      actions:
      - action: notify.all_phones
        data:
          message: De vaatwasser is klaar
          data:
            persistent: true
            tag: persistent
      - action: tts.google_translate_say
        entity_id: media_player.office_googlehome
        data_template:
          message: De vaatwasser is klaar
- id: '1620203713941'
  alias: Locks - Auto lock the doors
  description: We didn't enable the Guest mode and we both left, lock the doors if
    they are not
  trigger:
  - trigger: state
    entity_id:
    - zone.home
    to: '0'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: lock.nuki_voordeur_slot_lock
      state: unlocked
  action:
  - action: lock.lock
    target:
      entity_id: lock.nuki_voordeur_slot_lock
    data: {}
  mode: single
- id: '1621189950296'
  alias: Presence - Enable detection because one of us left or in night mode
  description: Activate Frigate object detection
  trigger:
  - trigger: state
    for:
      hours: 0
      minutes: 0
      seconds: 15
    entity_id:
    - zone.home
    to: '1'
  - trigger: numeric_state
    entity_id: zone.home
    below: '2'
  - trigger: state
    entity_id:
    - alarm_control_panel.alarmo
    from: disarmed
    to: armed_night
  condition: []
  action:
  - action: switch.turn_on
    target:
      entity_id:
      - switch.achterdeur_detect
      - switch.terras_detect
      - switch.veranda_detect
      - switch.bijkeuken_detect
      - switch.zwembad_detect
    data: {}
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: armed_night
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      entity_id:
      - switch.evabed_detect
      - switch.noabed_detect
  mode: single
- id: '1621190465429'
  alias: Presence - Disable detection because day starts
  description: Deactivate Frigate object detection
  trigger:
  - trigger: state
    entity_id:
    - alarm_control_panel.alarmo
    from: armed_night
    to: disarmed
  condition: []
  action:
  - action: switch.turn_off
    target:
      entity_id:
      - switch.achterdeur_detect
      - switch.terras_detect
      - switch.veranda_detect
      - switch.bijkeuken_detect
      - switch.evabed_detect
      - switch.noabed_detect
      - switch.zwembad_detect
    data: {}
  mode: single
- id: '1621192167984'
  alias: Night - Check for open windows and doors
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - alarm_control_panel.alarmo
    from: disarmed
    to: armed_night
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.open_windows_and_doors_downstairs
      state: '0'
  action:
  - action: script.sonos_say
    data_template:
      sonos_entity: media_player.eetkamer
      volume: 20
      message: Let op, er staan beneden nog ramen of deuren open!
  mode: single
- id: '1621192941666'
  alias: Doors - Alert when frontdoor is open too long
  description: ''
  trigger:
  - trigger: state
    entity_id: binary_sensor.frontdoor_openclose_contact
    for: '1800'
    from: 'off'
    to: 'on'
  condition: []
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F6AA Deur: let op, de voordeur staat al 10 minuten open"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1621232858848'
  alias: Doors - Nuki battery critical
  description: ''
  trigger:
  - trigger: state
    entity_id: binary_sensor.nuki_voordeur_slot_battery_critical
    to: 'on'
    for:
      hours: 1
      minutes: 0
      seconds: 0
    from: 'off'
  condition: []
  action:
  - action: persistent_notification.create
    data:
      title: Batterij Nuki
      message: Let op, batterij status van het voordeur slot is kritiek!
  mode: single
- id: '1623609811213'
  alias: Screens - Close screens voorraam on warm sunny days
  description: In case it's warm and sunny, close the screens in the morning but the
    one on the side a bit later
  trigger:
  - trigger: time_pattern
    minutes: /15
  condition:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.today_maximum_temperature
          above: '20'
        - condition: numeric_state
          entity_id: sensor.openweathermap_cloud_coverage
          below: '80'
        alias: Warm and not too much clouds
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.openweathermap_cloud_coverage
          below: '95'
        - condition: numeric_state
          entity_id: sensor.today_maximum_temperature
          above: '24'
        alias: Just hot or warm and not so cloudy
    - condition: device
      device_id: eb69e1ad4596ef0df19b685a4e84e026
      domain: cover
      entity_id: cover.voorraam
      type: is_open
  - condition: time
    after: 09:00:00
    before: '17:00:00'
  - condition: state
    entity_id: sensor.rate_rain_piezo
    state: '0.0'
  - condition: state
    entity_id: input_boolean.enable_automatic_screens
    state: 'on'
  action:
  - action: notify.all_phones
    data:
      message: ☀️ De screens aan de voorkant gaan dicht
      data:
        persistent: true
        tag: persistent
  - action: cover.close_cover
    target:
      entity_id: cover.voorraam
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1623609934943'
  alias: Screens - Open screen voorraam
  description: Open the screen by the end of the day or when the sun is gone or when
    it's too windy
  trigger:
  - trigger: time
    at: '18:00:00'
  - trigger: numeric_state
    entity_id: sensor.openweathermap_forecast_cloud_coverage
    above: '90'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: numeric_state
    entity_id: sensor.rate_rain_piezo
    for:
      hours: 0
      minutes: 0
      seconds: 10
    above: '0'
    below: '1000'
  condition:
  - condition: and
    conditions:
    - condition: device
      device_id: eb69e1ad4596ef0df19b685a4e84e026
      domain: cover
      entity_id: cover.voorraam
      type: is_closed
    - condition: state
      entity_id: input_boolean.enable_automatic_screens
      state: 'on'
  action:
  - action: notify.all_phones
    data:
      message: ☀️ De screen aan de voorkant gaat open
      data:
        persistent: true
        tag: persistent
  - action: cover.open_cover
    data: {}
    target:
      entity_id: cover.voorraam
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: cover.open_cover
    data: {}
    target:
      entity_id: cover.voorraam
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: cover.open_cover
    data: {}
    target:
      entity_id: cover.voorraam
  mode: single
- id: '1623610181205'
  alias: Screens - Open screen zijraam
  description: Open the screen by the end of the day or when the sun is gone or it's
    too windy
  trigger:
  - trigger: time
    at: '21:00'
  - trigger: numeric_state
    entity_id: sensor.openweathermap_forecast_cloud_coverage
    above: '90'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: sun
    event: sunset
    offset: -00:30:00
  - trigger: numeric_state
    entity_id: sensor.rate_rain_piezo
    for:
      hours: 0
      minutes: 0
      seconds: 10
    above: '0'
    below: '1000'
  condition:
  - condition: and
    conditions:
    - condition: device
      device_id: 7a674f956b15af8decebb36355772928
      domain: cover
      entity_id: cover.zijraam
      type: is_closed
  - condition: state
    entity_id: input_boolean.enable_automatic_screens
    state: 'on'
  action:
  - action: notify.all_phones
    data:
      message: ☀️ De screen aan de zijkant gaat open
      data:
        persistent: true
        tag: persistent
  - action: cover.open_cover
    data: {}
    target:
      entity_id: cover.zijraam
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: cover.open_cover
    data: {}
    target:
      entity_id: cover.zijraam
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: cover.open_cover
    data: {}
    target:
      entity_id: cover.zijraam
  mode: single
- id: '1623656513564'
  alias: Sleep - Switch to night mode automatically when home
  description: In case we're home but forgot night mode, do it for us
  trigger:
  - trigger: time
    at: 00:30
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: disarmed
  - condition: state
    entity_id: person.rob
    state: home
  - condition: state
    entity_id: person.steffi
    state: home
  - condition: state
    entity_id: light.socket2_light_couch
    state: 'off'
  - condition: state
    entity_id: binary_sensor.hallwaydoor_openclose_contact
    state: 'off'
  action:
  - action: script.sleep_well
    data: {}
  - action: light.turn_off
    target:
      entity_id:
      - light.socket1_light_corner
      - light.socket2_light_couch
  - action: alarm_control_panel.alarm_arm_night
    target:
      entity_id: alarm_control_panel.alarmo
    data: {}
  mode: single
- id: '1625051357630'
  alias: Presence - Disable detection because we are both home
  description: Deactivate Frigate object detection
  trigger:
  - trigger: state
    for: 0:00:15
    entity_id: person.rob,person.steffi
    to: home
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: person.rob
      state: home
    - condition: state
      entity_id: person.steffi
      state: home
  action:
  - action: switch.turn_off
    target:
      entity_id:
      - switch.achterdeur_detect
      - switch.terras_detect
      - switch.veranda_detect
      - switch.bijkeuken_detect
      - switch.evabed_detect
      - switch.noabed_detect
      - switch.zwembad_detect
  mode: single
- id: '1625685710817'
  alias: Car - Lock the doors when open too long
  description: Lock the car automatically after 15 minutes
  trigger:
  - trigger: state
    entity_id: binary_sensor.ix3_door_lock_state
    to: 'on'
    for: 02:00:00
  condition: []
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F697 De auto is automatisch op slot gezet"
      data:
        persistent: true
        tag: persistent
  - action: lock.lock
    target:
      entity_id: lock.ix3_lock
  mode: single
- id: '1625773685228'
  alias: Alarm - Disable alarm manually
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - sensor.switch_alarm_activity_action
    to: 'on'
  condition:
  - condition: not
    conditions:
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_disarmed
  action:
  - device_id: 29fa064f108236608f9f0d8f063dbc17
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: disarm
    code: automation
  - action: script.sonos_say
    data:
      sonos_entity: media_player.living_room
      volume: 30
      message: Het alarm is voor 2 uur uitgezet.
  - delay:
      hours: 1
      minutes: 55
      seconds: 0
      milliseconds: 0
  - action: script.sonos_say
    data:
      sonos_entity: media_player.living_room
      volume: 30
      message: Let op, het alarm wordt over 5 minuten weer geactiveerd.
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - device_id: 29fa064f108236608f9f0d8f063dbc17
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: arm_away
  - action: notify.all_phones
    data:
      message: De tijd is om, het alarm wordt weer geactiveerd.
      data:
        persistent: true
        tag: persistent
  - action: script.sonos_say
    data:
      sonos_entity: media_player.living_room
      volume: 30
      message: Let op, het alarm is weer geactiveerd. Druk op de knop om het weer
        uit te zetten.
  mode: single
- id: '1625814711652'
  alias: Doors - Alert when backdoor is open too long
  description: ''
  trigger:
  - trigger: state
    entity_id: binary_sensor.backdoor_openclose_contact
    for: '1800'
    from: 'off'
    to: 'on'
  condition: []
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F6AA Deur: let op, de achterdeur staat al 10 minuten open"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1627719809039'
  alias: Doors - Alert when sheddoor is open too long and we're away
  description: ''
  trigger:
  - trigger: state
    entity_id: binary_sensor.sheddoor_openclose_contact
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.sheddoor_back_openclose_contact
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.cabindoor_openclose_contact
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: zone.home
    state: '0'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: not
    conditions:
    - condition: state
      entity_id: person.steffi
      state: home
  - condition: not
    conditions:
    - condition: state
      entity_id: person.rob
      state: home
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F6AA Deur: let op, de schuur- of blokhutdeur gaat open maar
        wij zijn niet thuis"
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1628796760216'
  alias: Alarm - Turn on lights when person events on camera
  description: ''
  trigger:
  - trigger: mqtt
    topic: frigate/events
  condition:
  - condition: or
    conditions:
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_night
    - condition: device
      device_id: 29fa064f108236608f9f0d8f063dbc17
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: is_armed_away
  - condition: template
    value_template: '{{ trigger.payload_json[''after''][''label''] == ''person'' }}'
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''achterdeur''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''terras''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''veranda''
        }}'
    - condition: template
      value_template: '{{ trigger.payload_json[''after''][''camera''] == ''bijkeuken''
        }}'
  - condition: numeric_state
    entity_id: sensor.light_sensor_garden
    below: '10'
  - condition: state
    entity_id: light.garden_light
    state: 'off'
  action:
  - action: light.turn_on
    target:
      entity_id:
      - light.garden_light
      - light.veranda_light
  - action: notify.all_phones
    data:
      message: Er is een persoon gedetecteerd op een camera!
      data:
        persistent: true
        tag: persistent
        push:
          sound: alarm.caf
          critical: 1
          volume: 1
          interruption-level: critical
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - action: light.turn_off
    target:
      entity_id:
      - light.garden_light
      - light.veranda_light
  mode: single
- id: '1629016952694'
  alias: Alarm - Notify why arming failed
  description: ''
  trigger:
  - trigger: event
    event_type: alarmo_failed_to_arm
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.reason == ''open_sensors'' }}'
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F6A8 Alarm kan niet geactiveerd worden omdat: {% for entity_id
        in trigger.event.data.sensors %}\n  - {{ state_attr(entity_id, 'friendly_name')
        }} is {{ states(entity_id) }}\n{% endfor %}\n"
      data:
        persistent: true
        tag: persistent
  - action: script.sonos_say
    data:
      sonos_entity: media_player.eetkamer
      volume: 20
      message: "Alarm kan niet geactiveerd worden omdat: {% for entity_id in trigger.event.data.sensors
        %}\n  - {{ state_attr(entity_id, 'friendly_name') }} staat {{ states(entity_id)
        }}\n{% endfor %}\n"
  mode: single
- id: '1633552734408'
  alias: Alarm - Enable guest mode when nanny or cleaner home
  description: Enable on Thursday when we're away or leaving the house
  trigger:
  - trigger: time
    at: '12:30:00'
  - trigger: state
    entity_id:
    - zone.home
    to: '0'
  condition:
  - condition: time
    weekday:
    - thu
    before: '18:30'
    after: '12:00:00'
  - condition: state
    entity_id: zone.home
    state: '0'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  action:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.guest_mode
    data: {}
  - device_id: 29fa064f108236608f9f0d8f063dbc17
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: disarm
    code: automation
  - action: notify.all_phones
    data:
      message: Guest modus aangezet en alarm uit voor Maartje
      data:
        persistent: true
        tag: persistent
  - delay:
      hours: 11
      minutes: 0
      seconds: 0
      milliseconds: 0
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.guest_mode
    data: {}
  mode: single
- id: '1635279877594'
  alias: Lights - Turn on lights when dark - arriving
  description: When we come home after sunset, a few lights are on, so turn on more
    lights
  trigger:
  - trigger: state
    entity_id: person.rob,person.steffi
    to: home
    for: 0:00:30
  - trigger: state
    entity_id: device_tracker.ix3
    from: not_home
    to: home
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: zone.home
      state: '0'
    - condition: state
      entity_id: light.livingfront_light
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.light_sensor_living_illuminance_lux
      below: '30'
  action:
  - action: script.lights_on_home
    data: {}
  mode: single
- id: '1635280472840'
  alias: Lights - Turn off lights when dark - leaving
  description: We leave the house in when dark, turn off a few lights
  trigger:
  - trigger: state
    entity_id:
    - zone.home
    to: '0'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.livingfront_light
        state: 'on'
      - condition: state
        entity_id: light.kitchendesk_light
        state: 'on'
      - condition: state
        entity_id: light.diningtable_light
        state: ''
  action:
  - action: light.turn_off
    target:
      entity_id:
      - light.kitchendesk_light
      - light.diningtable_light
      - light.livingfront_light
      - light.office_light
    data: {}
  - action: light.turn_on
    target:
      entity_id:
      - light.livingback_light
      - light.kitchen_light
      - light.dining_light
      - light.socket2_light_couch
      - light.socket1_light_corner
    data:
      brightness_pct: 30
  mode: single
- id: '1635280845679'
  alias: Lights - Turn off lights when lighter
  description: Turn off lights in the morning or during the day after a darker period
  trigger:
  - trigger: numeric_state
    entity_id: sensor.light_sensor_living_illuminance_lux
    above: '60'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: time
      after: 05:00
      before: '22:30'
    - condition: state
      entity_id: input_boolean.enable_automatic_lights
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.socket1_light_corner
        state: 'on'
      - condition: state
        entity_id: light.kitchendesk_light
        state: 'on'
  action:
  - action: script.lights_down_stairs_off
    data: {}
  mode: single
- id: '1635281191811'
  alias: Music - Turn off music when we left
  description: We didn't enable the Guest mode and we both left, stop the music
  trigger:
  - trigger: state
    entity_id:
    - zone.home
    to: '0'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: disarmed
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - action: media_player.media_pause
    target:
      entity_id:
      - media_player.eetkamer
      - media_player.office
      - media_player.living_room
    data: {}
  mode: single
- id: '1636140714636'
  alias: Car - Alert when car windows open too long
  description: Lets not let the rain in for too long, again
  trigger:
  - trigger: state
    entity_id: binary_sensor.ix3_windows
    to: 'on'
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F697 De ramen van de auto staan al een uurtje open."
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1636204195732'
  alias: System - Notify entities being offline
  description: Check for a specific list of monitored entities if they are available
  trigger:
  - trigger: state
    entity_id: sensor.unavailable_entities
    for:
      hours: 0
      minutes: 5
      seconds: 10
    from: Online
  action:
  - action: persistent_notification.create
    data:
      title: Belangrijke devices
      message: "\U0001F4A1 Er is een belangrijke entity offline {{ became_unavailable
        }}"
  variables:
    from_state: '{{ states(''input_text.unavailable_entities_temp_state'') }}'
    from_state_list: '{{ from_state.split('', '') }}'
    to_state: '{{ trigger.to_state.state if trigger.to_state.state != ''Online'' else
      '''' }}'
    to_state_list: '{{ to_state.split('', '') }}'
    became_online: '{{ from_state_list | reject(''in'', to_state_list) | join('',
      '') }}'
    became_unavailable_list: '{{ to_state_list | reject(''in'', from_state_list) |
      list }}'
    became_unavailable: '{{ became_unavailable_list | join('', '') }}'
    other_unavailable_entities: '{{ to_state_list | reject(''in'', became_unavailable_list)
      | join('', '') }}'
- id: '1636228242323'
  alias: Alarm - Flash lights
  description: If the alarm is triggered, flash the lights in house and garden and
    restore the state afterwards
  use_blueprint:
    path: myGithub-Markus/flashing_lights.yaml
    input:
      target_lights:
        entity_id:
        - light.office_light
        - light.livingback_light
        - light.livingfront_light
        - light.dining_light
        - light.garden_light
        - light.kitchen_light
      activated: input_boolean.alarm_active
      delay: 500
- id: '1638997192801'
  alias: Lights - Turn off lights upstairs when leaving
  description: When we move away, all upstairs can be turned off
  trigger:
  - trigger: state
    entity_id:
    - zone.home
    to: '0'
  condition:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: light.lights_upstairs
    state: 'on'
  action:
  - action: script.lights_off_upstairs
    data: {}
  mode: single
- id: '1639680674230'
  alias: iOS - Good night
  description: Good night action from app or watch
  trigger:
  - trigger: event
    event_type: ios.action_fired
    event_data:
      actionName: good_night
  condition:
  - condition: time
    after: '21:00'
    before: 05:00
  action:
  - parallel:
    - action: script.sleep_well
      data: {}
    - action: alarm_control_panel.alarm_arm_night
      target:
        entity_id: alarm_control_panel.alarmo
      data: {}
    - sequence:
      - action: light.turn_on
        data:
          brightness_pct: 30
        target:
          entity_id: light.dimmer_hall
      - delay:
          hours: 0
          minutes: 0
          seconds: 15
          milliseconds: 0
      - action: light.turn_off
        target:
          entity_id: light.dimmer_hall
        data: {}
      alias: Turn on hall light shortly
  - alias: Turn off the couch and corner light too if it's after 11 pm
    condition: time
    after: '22:55:00'
  - action: light.turn_off
    target:
      entity_id:
      - light.socket1_light_corner
      - light.socket2_light_couch
    data: {}
  mode: single
- id: '1639684695002'
  alias: Alarm - Silence alarm by notification
  description: Silence alarm when beeping through push notification action when
  trigger:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: SILENCE_ALARM
    context:
      user_id:
      - 56ef6157f087451399aa545f32dc78d3
      - 71e44d7d313b4695a8bf51705f7adfc3
  condition: []
  action:
  - action: alarm_control_panel.alarm_disarm
    data:
      code: automation
    target:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1641574319382'
  alias: Energy - Count Water Usage
  description: Count Water Usage through Esphome sensor
  use_blueprint:
    path: Techwolf12/watermeter.yaml
    input:
      counter: counter.watermeter_consumption_counter
      watermeterkit: sensor.water_meter_total_consumption
- id: '1642265273034'
  alias: Heating - Turn on heating main bedroom
  description: Turn on heating before schedule turns on
  trigger:
  - trigger: time
    at: 09:55
  condition: []
  action:
  - action: switch.turn_on
    target:
      entity_id: switch.shelly_plug_kachel_slaapkamer
  mode: single
- id: '1642265325725'
  alias: Heating - Turn off heating main bedroom
  description: Turn on heating after schedule turns off
  trigger:
  - trigger: time
    at: '22:05:00'
  condition: []
  action:
  - action: switch.turn_off
    target:
      entity_id: switch.shelly_plug_kachel_slaapkamer
    data: {}
  mode: single
- id: '1642502040367'
  alias: Heating - Control heating Noa
  description: This turns on the infra red heating panel in Noa's room
  use_blueprint:
    path: robsonke/heating.yaml
    input:
      heating: switch.infraroodpanel_noa
      temp_sensor: sensor.climate_sensor_noa_temperature
      min_temp: 16
      set_temp: 18
      time_after: 09:00:00
      time_before: '18:00:00'
      run_on_monday: true
      run_on_tuesday: true
      run_on_wednesday: true
      run_on_thursday: true
      run_on_friday: true
      run_on_saturday: true
      run_on_sunday: true
      window_sensor: binary_sensor.window_noaroom_openclose_contact
      price_level_sensor: sensor.energy_price_level
      price_level_percentage: 110
- id: '1644162797655'
  alias: Heating - Control heating bedroom
  description: Turn on between 10h and 19h only when the temperature is too low and
    the windows are closed
  triggers:
  - trigger: homeassistant
    event: start
  - trigger: time_pattern
    minutes: /10
  - trigger: state
    entity_id:
    - sensor.energy_price_level
  - trigger: state
    entity_id:
    - binary_sensor.window_masterbed_1_openclose_contact
    - binary_sensor.window_masterbed_2_openclose_contact
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: time
        after: '10:00'
        before: '22:00:00'
      - condition: numeric_state
        entity_id: sensor.climate_sensor_masterbedroom_temperature
        below: 19
      - type: is_not_open
        condition: device
        device_id: e495b09d382329f43540381dedb31f15
        entity_id: binary_sensor.window_masterbed_1_openclose_contact
        domain: binary_sensor
      - type: is_not_open
        condition: device
        device_id: 83daade23505c1645165605bc56c49d1
        entity_id: binary_sensor.window_masterbed_2_openclose_contact
        domain: binary_sensor
      - condition: state
        entity_id: binary_sensor.cheapest_16_hours_24h
        state: 'on'
        alias: The price should be not too high
      sequence:
      - device_id: 63bfcece97a8578bf632cddbc75ee61d
        domain: select
        entity_id: select.eurom_alutherm_capacity
        type: select_option
        option: Auto
      - action: climate.set_temperature
        data:
          hvac_mode: heat
          temperature: 18
        target:
          entity_id: climate.eurom_alutherm_baseboard_heater
    default:
    - device_id: 63bfcece97a8578bf632cddbc75ee61d
      domain: select
      entity_id: select.eurom_alutherm_capacity
      type: select_option
      option: 'Off'
  trace:
    stored_traces: 50
  mode: queued
  max: 4
- id: '1644692915726'
  alias: Garden - Turn off garden lights - evening
  description: Turn off lights in the garden in the evening but keep a few on on low
    brightness. Turn off when we go to bed, guest mode is off or otherwise at 23:00.
  triggers:
  - at: '23:00'
    trigger: time
  - at: 01:00
    trigger: time
  - entity_id:
    - alarm_control_panel.alarmo
    to: armed_night
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.enable_automatic_garden_lights
    state: 'on'
  - condition: or
    conditions:
    - condition: time
      after: '22:59:00'
    - condition: time
      after: 00:00:00
      before: 02:00:00
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_night
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_away
    - condition: time
      after: 00:00:00
      before: 02:00:00
  actions:
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - action: light.turn_off
    data: {}
    target:
      entity_id:
      - light.veranda_light
      - light.kerst_buiten
  - action: light.turn_off
    data: {}
    target:
      entity_id:
      - light.woodshed_light
      - light.palm1_light
      - light.palm2_light
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - action: light.turn_on
    data:
      brightness_pct: 30
    target:
      entity_id:
      - light.garden_lantern_light1
      - light.garden_lantern_light2
      - light.garden_lantern_light3
      - light.garden_light
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - action: light.turn_off
    data: {}
    target:
      entity_id: light.hue_lights_garden
  mode: single
- id: '1645647196286'
  alias: Windows - Masterbedroom1 open and low temperature
  description: ''
  use_blueprint:
    path: robsonke/window-open-temperature.yaml
    input:
      temp_sensor: sensor.climate_sensor_masterbedroom_temperature
      window_sensor: binary_sensor.window_masterbed_1_openclose_contact
      min_temp: 15
      actions:
      - action: notify.all_phones
        data:
          message: "\U0001F3E0 Het raam in de slaapkamer staat open en het begint
            nu wel een beetje fris te worden."
          data:
            persistent: true
            tag: persistent
- id: '1645648583598'
  alias: Windows - Masterbedroom2 open and low temperature
  description: ''
  use_blueprint:
    path: robsonke/window-open-temperature.yaml
    input:
      temp_sensor: sensor.climate_sensor_masterbedroom_temperature
      window_sensor: binary_sensor.window_masterbed_2_openclose_contact
      min_temp: 15
      actions:
      - action: notify.all_phones
        data:
          message: "\U0001F3E0 Het raam in de slaapkamer staat open en het begint
            nu wel een beetje fris te worden."
          data:
            persistent: true
            tag: persistent
- id: '1645648632551'
  alias: Windows - Noa open and low temperature
  description: ''
  use_blueprint:
    path: robsonke/window-open-temperature.yaml
    input:
      temp_sensor: sensor.climate_sensor_noa_temperature
      window_sensor: binary_sensor.window_noa_openclose_sensor
      min_temp: 15
      actions:
      - action: notify.all_phones
        data:
          message: "\U0001F3E0 Het raam bij Noa staat open en het begint nu wel een
            beetje fris te worden."
          data:
            persistent: true
            tag: persistent
- id: '1659861088978'
  alias: Screens - Close screens zijraam on warm sunny days
  description: In case it's warm and sunny, close the screens in the morning but the
    one on the side a bit later
  trigger:
  - trigger: state
    entity_id:
    - sensor.rate_rain_piezo
    - sensor.today_maximum_temperature
    - sensor.openweathermap_forecast_cloud_coverage
  condition:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.today_maximum_temperature
          above: '20'
        - condition: numeric_state
          entity_id: sensor.openweathermap_cloud_coverage
          below: '80'
        alias: Is the temperature forecast 20C+ and the cloud coverage below 80%
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.openweathermap_cloud_coverage
          below: '95'
        - condition: numeric_state
          entity_id: sensor.today_maximum_temperature
          above: '24'
        alias: Just hot or warm and not so cloudy
      alias: Is it warm and not too cloudy or just warmer?
    - condition: state
      entity_id: cover.zijraam
      state: open
  - condition: time
    after: '11:00:00'
    before: '19:00:00'
  - condition: state
    entity_id: sensor.rate_rain_piezo
    state: '0.0'
  - condition: state
    entity_id: input_boolean.enable_automatic_screens
    state: 'on'
  action:
  - action: notify.all_phones
    data:
      message: ☀️ De screens aan de zijkant gaan dicht
      data:
        persistent: true
        tag: persistent
  - action: cover.close_cover
    data: {}
    target:
      entity_id: cover.zijraam
  mode: single
- id: '1659880318627'
  alias: Pool - Control the Pool Heatpump
  description: Turn on the pool heat pump and choose a run mode (normal/silent/super
    silent) based on need and energy pricing and outdoor temperature
  trigger:
  - trigger: state
    entity_id: sensor.today_maximum_temperature
  - trigger: state
    entity_id:
    - binary_sensor.pool_pump_active
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: state
    entity_id: sensor.pool_heating_temperature_diff
  - trigger: state
    entity_id:
    - binary_sensor.cheapest_16_hours_24h
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.enable_pool_automations
    state: 'on'
  - condition: state
    entity_id: binary_sensor.cheapest_16_hours_24h
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.today_maximum_temperature
    above: 15
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.cheapest_16_hours_24h
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.today_maximum_temperature
        above: 14
      - condition: state
        entity_id: binary_sensor.pool_pump_active
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.pool_heating_temperature_diff
        above: 1
      sequence:
      - action: switch.turn_on
        data: {}
        target:
          entity_id: switch.pool_fairland_heatpump_power_switch
      - choose:
        - conditions:
          - condition: numeric_state
            entity_id: sensor.pool_heating_temperature_diff
            above: 2
            alias: If we are about to get close to the target temperature
          sequence:
          - action: select.select_option
            metadata: {}
            data:
              option: Normal
            target:
              entity_id: select.pool_fairland_heatpump_power_mode
        - conditions:
          - condition: numeric_state
            entity_id: sensor.pool_heating_temperature_diff
            above: 1
            alias: If we are about to get closer to the target temperature
          sequence:
          - action: select.select_option
            metadata: {}
            data:
              option: Silence
            target:
              entity_id: select.pool_fairland_heatpump_power_mode
        default:
        - action: select.select_option
          metadata: {}
          data:
            option: Super Silence
          target:
            entity_id: select.pool_fairland_heatpump_power_mode
    default:
    - action: switch.turn_off
      data: {}
      target:
        entity_id: switch.pool_fairland_heatpump_power_switch
  mode: single
  max_exceeded: silent
  trace:
    stored_traces: 50
- id: '1659881596095'
  alias: DHW - Disable warm water heating
  description: Disable the heatpump based on need and energy pricing. Also lower the
    expected temperature to avoid the pump itself decides to turn on.
  trigger:
  - trigger: numeric_state
    entity_id: sensor.energy_price_level
    attribute: percentage
    above: '115'
  - trigger: state
    entity_id:
    - water_heater.domestic_hot_water_tank
    attribute: current_temperature
  - trigger: state
    entity_id:
    - water_heater.domestic_hot_water_tank
    attribute: temperature
  - trigger: time_pattern
    minutes: /15
  condition:
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.energy_price_level
      attribute: percentage
      above: '115'
    - condition: template
      value_template: '{{ state_attr(''water_heater.domestic_hot_water_tank'',''current_temperature'')
        | float >= state_attr(''water_heater.domestic_hot_water_tank'',''temperature'')
        | float }}'
  - condition: numeric_state
    entity_id: water_heater.domestic_hot_water_tank
    attribute: current_temperature
    above: '40'
  - condition: state
    entity_id: water_heater.domestic_hot_water_tank
    attribute: operation_mode
    state: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 0
  action:
  - action: water_heater.set_temperature
    data:
      temperature: 30
    target:
      entity_id: water_heater.domestic_hot_water_tank
  - action: water_heater.set_operation_mode
    data:
      operation_mode: 'off'
    target:
      entity_id: water_heater.domestic_hot_water_tank
  trace:
    stored_traces: 10
  mode: single
- id: '1661977922126'
  alias: HVAC - Control Operation Mode downstairs
  description: 'Set the HVAC mode (heat/cool/off) for the heat pump. By default off,
    cooling when it is expected to be hot outside and also becoming hotter inside,
    heating when the indoor temperature is low and outside also getting cooler.

    This still doesn''t mean that the pump would start, it will still use its indoor
    sensors. And even when it does turn on, other automations might stop that, based
    on the heating and cooling input booleans.'
  trigger:
  - trigger: state
    entity_id:
    - sensor.downstairs_temperature
  condition: []
  action:
  - choose:
    - conditions:
      - alias: Confirm if the temperature is below the minimum allowed temperature
        condition: template
        value_template: '{{ states(''sensor.downstairs_temperature'') < states(''input_number.hvac_heating_limit'')
          }}'
      - condition: numeric_state
        entity_id: sensor.today_maximum_temperature
        below: 18
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.warmtepomp
          attribute: hvac_action
          state: heating
        alias: Action should not be set to heating already
      sequence:
      - action: climate.set_hvac_mode
        target:
          entity_id: climate.warmtepomp
        data:
          hvac_mode: heat
        alias: Set HVAC to heating
      - action: select.select_option
        data:
          option: heating
        target:
          entity_id: select.operation_mode
    - conditions:
      - alias: Confirm if the temperature is below the maximum and above the minimum
          allowed temperature
        condition: template
        value_template: '{{ states(''sensor.downstairs_temperature'') < states(''input_number.hvac_cooling_limit'')
          and states(''sensor.downstairs_temperature'') > states(''input_number.hvac_heating_limit'')
          }}'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.warmtepomp
          attribute: hvac_action
          state: 'off'
      sequence:
      - action: climate.set_hvac_mode
        target:
          entity_id: climate.warmtepomp
        data:
          hvac_mode: 'off'
        alias: Turn HVAC off
    - conditions:
      - alias: Confirm if the temperature is above the maximum allowed temperature
        condition: template
        value_template: '{{ states(''sensor.downstairs_temperature'') > states(''input_number.hvac_cooling_limit'')
          }}'
      - condition: numeric_state
        entity_id: sensor.today_maximum_temperature
        above: '24'
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.warmtepomp
          attribute: hvac_action
          state: cooling
        alias: Action should not be set to cooling already
      sequence:
      - action: climate.set_hvac_mode
        target:
          entity_id: climate.warmtepomp
        data:
          hvac_mode: cool
        alias: Set HVAC to cooling
      - action: select.select_option
        data:
          option: cooling
        target:
          entity_id: select.operation_mode
  trace:
    stored_traces: 20
- id: '1662889733680'
  alias: Screens - Disable the automatic control of the screens in case of a manual
    action
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - cover.voorraam
    - cover.zijraam
    alias: When the position of the screens change
    attribute: current_position
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ trigger.to_state.context.parent_id == none }}'
    - condition: template
      value_template: '{{ trigger.to_state.context.user_id == none }}'
      enabled: true
    - condition: template
      value_template: '{{ trigger.to_state.context.id != none }}'
    alias: Only in case of a manual user interaction
  action:
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.enable_automatic_screens
    alias: Disable the automatic screens control for today
  mode: single
- id: '1663352793600'
  alias: System - Alert when the shed fridge is off too long
  description: ''
  use_blueprint:
    path: robsonke/device-off-warning.yaml
    input:
      switch: switch.shelly_plug_s_8_fridge1_relay
      max_time_off: 30
      actions:
      - action: persistent_notification.create
        data:
          title: Vriezer schuur!
          message: "\U0001F9CA Let op, de vriezer in de schuur staat al een half uur
            uit!"
      - action: notify.all_phones
        data:
          message: "\U0001F9CA Let op, de vriezer in de schuur staat al een half uur
            uit!"
          data:
            persistent: true
            tag: persistent
- id: '1663352887163'
  alias: System - Alert when the kitchen cooling is off too long
  description: ''
  use_blueprint:
    path: robsonke/device-off-warning.yaml
    input:
      switch: switch.shelly_plug_koelkast_relay
      max_time_off: 30
      actions:
      - action: notify.all_phones
        data:
          message: "\U0001F9CA Let op, de koelkast staat al een half uur uit!"
          data:
            persistent: true
            tag: persistent
      - action: persistent_notification.create
        data:
          title: Koelkast schuur!
          message: "\U0001F9CA Let op, de koelkast staat al een half uur uit!"
- id: '1663353341942'
  alias: System - Alert in case of heavy water usage in one day
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - sensor.water_daily
  condition:
  - condition: numeric_state
    entity_id: sensor.water_daily
    above: 5
  action:
  - action: persistent_notification.create
    data:
      title: Water verbruik
      message: "\U0001F4A6 Let op, we hebben vandaag al meer dan 5 kuub water verbruikt!"
  mode: single
- id: '1663403485592'
  alias: HVAC - Set default temperature
  description: This sets the temperature based on the heating or cooling mode. We
    also reset the target temperature every night, in case somebody overruled it.
    Overall, heatpumps better have some kind of default minimum, so we never go below
    18 degrees
  triggers:
  - trigger: state
    entity_id:
    - input_number.hvac_winter_target_temperature
    - input_number.hvac_summer_target_temperature
  - trigger: time
    at: 02:00:00
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: select.operation_mode
        state: heating
      sequence:
      - action: climate.set_temperature
        data_template:
          temperature: '{{ states(''input_number.hvac_winter_target_temperature'')
            | float }}'
        target:
          entity_id: climate.warmtepomp
        alias: Heat - Set temperature to the winter target during the day
    - conditions:
      - condition: state
        entity_id: select.operation_mode
        state: cooling
      sequence:
      - action: climate.set_temperature
        data_template:
          temperature: '{{ states(''input_number.hvac_summer_target_temperature'')
            | float }}'
        target:
          entity_id: climate.warmtepomp
        alias: Cool - Set temperature to the summer target
    alias: Set the right target temperature, depending on season
  trace:
    stored_traces: 20
  mode: single
- id: '1663405385606'
  alias: HVAC - Control the heatpump
  description: This controls whether the heatpump should be turned on or not. Based
    on pricing or potential PV over capacity (later). So far, using the price works
    oke, the higher the price, the more need there is for power, so the less we do.
  trigger:
  - trigger: state
    entity_id:
    - sensor.energy_price_level
  - trigger: state
    entity_id:
    - input_boolean.heating_downstairs
    - input_boolean.cooling_downstairs
  - trigger: state
    entity_id:
    - climate.warmtepomp
  condition:
  - condition: state
    entity_id: input_boolean.enable_automatic_hvac
    state: 'on'
    alias: Only dis/enable the heappump when the automation is active
  - condition: template
    value_template: '{{ trigger.from_state.state != "unavailable" and trigger.to_state.state
      != "unavailable" }}'
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.cheapest_16_hours_24h
          state: 'on'
          alias: Is this one of the cheapest hours of the day
        - condition: numeric_state
          entity_id: sensor.energy_price_level
          attribute: percentage
          below: 91
          alias: Or in case the price is low, probably giving the same result
        alias: Check if the price is oke
      - condition: not
        alias: Only when we are in heating or cooling mode
        conditions:
        - condition: state
          entity_id: climate.warmtepomp
          attribute: hvac_action
          state: 'off'
      - condition: or
        alias: And only when the generic thermostat said we need to heat or cool
        conditions:
        - condition: state
          entity_id: input_boolean.cooling_downstairs
          state: 'on'
        - condition: state
          entity_id: input_boolean.heating_downstairs
          state: 'on'
      sequence:
      - action: switch.turn_on
        data: {}
        target:
          entity_id: switch.climate_control
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: switch.climate_control
          state: 'off'
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.energy_price_level
          attribute: percentage
          above: 115
          alias: Or in case the price is too high
        - condition: and
          alias: And only when the generic thermostat said we do not need to heat
            and cool
          conditions:
          - condition: state
            entity_id: input_boolean.cooling_downstairs
            state: 'off'
          - condition: state
            entity_id: input_boolean.heating_downstairs
            state: 'off'
      sequence:
      - action: switch.turn_off
        data: {}
        target:
          entity_id: switch.climate_control
    default:
    - action: switch.turn_off
      data: {}
      target:
        entity_id: switch.climate_control
    alias: Turn on when needed and the price is oke, otherwise default off
  trace:
    stored_traces: 20
  mode: single
  max_exceeded: silent
- id: '1663492219970'
  alias: Presence - Disable Guest Mode when one of us comes home
  description: To avoid we forget to turn it off
  trigger:
  - trigger: state
    for:
      seconds: 15
    entity_id:
    - person.rob
    - person.steffi
    to: home
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: person.rob
      state: home
    - condition: state
      entity_id: person.steffi
      state: home
  - condition: state
    state: 'on'
    entity_id: input_boolean.guest_mode
  action:
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.guest_mode
  - action: notify.all_phones
    data:
      message: ⏰ Een van ons komt thuis, gast modus gaat nu uit
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1663526481065'
  alias: Heating - Control heaters bathrooms
  description: Turn simply on/off the heaters in both bathrooms. These are stupid
    devices with their own local thermostat, so we just turn them on to dry towells.
  trigger:
  - trigger: time
    at: 09:00:00
  - trigger: time
    at: '22:00:00'
  condition:
  - condition: numeric_state
    entity_id: sensor.today_maximum_temperature
    below: 14
    alias: Today Maximum Temperature Outside is below 18 degrees
  action:
  - action: switch.turn_on
    data: {}
    target:
      entity_id:
      - switch.shelly_plug_douche_verwarming_relay
      - switch.shelly_plug_badkamer_verwarming_relay
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - action: switch.turn_off
    data: {}
    target:
      entity_id:
      - switch.shelly_plug_badkamer_verwarming_relay
      - switch.shelly_plug_douche_verwarming_relay
  mode: single
- id: '1673167307057'
  alias: Humidifier - Alert when bin is full
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.master_bedroom_tank_full
    to: 'on'
    for:
      hours: 1
      minutes: 0
      seconds: 0
  condition: []
  action:
  - action: notify.all_phones
    data_template:
      message: "\U0001F4A6 De waterbak van de ontvochtiger zit vol, zsm legen"
      data:
        persistent: true
        tag: persistent
  - action: persistent_notification.create
    data:
      title: Ontvochtiger slaapkamer
      message: "\U0001F4A6 De waterbak van de ontvochtiger zit vol, zsm legen"
  mode: single
- id: '1673167830535'
  alias: Humidifier - Control the humidifier based on humidity, windows and electricity
    pricing
  description: Turn on between 10h and 22h only when the air is too humid and the
    windows are closed
  trigger:
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - sensor.energy_price_level
  - trigger: state
    entity_id:
    - binary_sensor.window_masterbed_1_openclose_contact
    - binary_sensor.window_masterbed_2_openclose_contact
  condition: []
  action:
  - choose:
    - conditions:
      - condition: time
        after: '10:00'
        before: '22:00:00'
      - condition: numeric_state
        entity_id: sensor.master_bedroom_humidity
        above: '50'
      - type: is_not_open
        condition: device
        device_id: e495b09d382329f43540381dedb31f15
        entity_id: binary_sensor.window_masterbed_1_openclose_contact
        domain: binary_sensor
      - type: is_not_open
        condition: device
        device_id: 83daade23505c1645165605bc56c49d1
        entity_id: binary_sensor.window_masterbed_2_openclose_contact
        domain: binary_sensor
      - condition: state
        entity_id: binary_sensor.cheapest_16_hours_24h
        state: 'on'
        alias: The price should be not too high
      sequence:
      - type: turn_on
        device_id: 07b2e94a74ca7803550f5109008d6353
        entity_id: humidifier.master_bedroom
        domain: humidifier
      - device_id: 07b2e94a74ca7803550f5109008d6353
        domain: humidifier
        entity_id: humidifier.master_bedroom
        type: set_mode
        mode: Smart
    default:
    - type: turn_off
      device_id: 07b2e94a74ca7803550f5109008d6353
      entity_id: humidifier.master_bedroom
      domain: humidifier
  trace:
    stored_traces: 50
  mode: queued
  max: 4
- id: '1676024605779'
  alias: Heating - Control heating Eva
  description: This turns on the infra red heating panel in Eva's room
  use_blueprint:
    path: robsonke/heating.yaml
    input:
      heating: switch.kasa_infrarood_eva
      temp_sensor: sensor.climate_sensor_eva_temperature
      min_temp: 16
      set_temp: 18
      time_after: 09:00:00
      time_before: '18:00:00'
      run_on_monday: true
      run_on_tuesday: true
      run_on_wednesday: true
      run_on_thursday: true
      run_on_friday: true
      run_on_saturday: true
      run_on_sunday: true
      window_sensor: binary_sensor.window_eva_openclose_contact
      price_level_sensor: sensor.energy_price_level
      price_level_percentage: 110
- id: '1677612384420'
  alias: System - Inform Frigate off
  description: Inform when Frigate isn't running, since we won't be recording either
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.frigate_nvr_running
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition: []
  action:
  - action: notify.mobile_app_iphone_rob
    data:
      message: "\U0001F3A5 Frigate staat uit, aanzetten aub"
      data:
        persistent: true
        tag: persistent
  - action: persistent_notification.create
    data:
      title: Frigate Addon
      message: "\U0001F3A5 Frigate staat uit, aanzetten aub"
  mode: single
- id: '1683057208426'
  alias: Vacuum - Alert Sjorsje offline
  description: Alert when Sjorsje is offline
  trigger:
  - trigger: state
    entity_id:
    - vacuum.sjorsje
  condition:
  - condition: state
    entity_id: vacuum.sjorsje
    state: unavailable
  action:
  - action: persistent_notification.create
    data:
      title: Sjorsje kwijt
      message: "\U0001F5D1 Sjorsje is onbereikbaar"
  mode: single
- id: '1684057104240'
  alias: Pool - Switch heating between silent and super silent
  description: Based on the target temperature and current temperature, move to silent
    or super silent mode.
  trigger:
  - trigger: state
    entity_id:
    - sensor.pool_fairland_heatpump_inlet_water_temperature
  - trigger: state
    entity_id:
    - number.pool_fairland_heatpump_target_temperature_heating
  - trigger: state
    entity_id:
    - binary_sensor.cheapest_16_hours_24h
  condition:
  - condition: state
    entity_id: input_boolean.enable_pool_automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states.number.pool_fairland_heatpump_target_temperature_heating.state
          | int(default=0) - states.sensor.pool_fairland_heatpump_inlet_water_temperature.state
          | int(default=0) > 0 }}'
        alias: If we are about to get close to the target temperature
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Super Silence
        target:
          entity_id: select.pool_fairland_heatpump_power_mode
    default:
    - action: select.select_option
      metadata: {}
      data:
        option: Silence
      target:
        entity_id: select.pool_fairland_heatpump_power_mode
  mode: single
- id: '1684057174715'
  alias: Pool - Alert when ph or redox values are not oke
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - sensor.eps_pool_ph_level
    - sensor.eps_pool_rx_level
    - binary_sensor.pool_pump_active
    for:
      hours: 0
      minutes: 0
      seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.enable_pool_automations
    state: 'on'
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.eps_pool_ph_level
      above: 8.5
      below: 6
    - condition: numeric_state
      entity_id: sensor.eps_pool_rx_level
      above: 850
    - condition: numeric_state
      entity_id: sensor.eps_pool_rx_level
      below: 500
    - condition: state
      entity_id: binary_sensor.pool_pump_active
      state: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - condition: state
      entity_id: sensor.eps_pool_ph_level
      state: unavailable
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - condition: state
      for:
        hours: 0
        minutes: 30
        seconds: 0
      entity_id: sensor.eps_pool_rx_level
      state: unavailable
  - condition: state
    entity_id: binary_sensor.pool_pump_active
    state: 'on'
  - condition: template
    value_template: "{% if as_timestamp(now()) | int -\n as_timestamp(states.automation.pool_alert_when_ph_or_redox_values_are_not_oke.attributes.last_triggered)\n
      \     | int > 57600 %} true {% else %} false {% endif %}"
    alias: Only trigger this automation once per 16 hours max
  action:
  - action: persistent_notification.create
    data:
      title: Zwembad waardes
      message: "\U0001F3CA De ph/orp waardes of flow van het zwembad zijn niet in
        orde."
  mode: single
- id: '1684059527700'
  alias: Energy - Alert when one of the three phases is high
  description: Keep an eye on using too much power for too long
  trigger:
  - trigger: numeric_state
    entity_id: sensor.current_phase_1
    for:
      hours: 0
      minutes: 30
      seconds: 0
    above: 25
  - trigger: numeric_state
    entity_id: sensor.current_phase_2
    for:
      hours: 0
      minutes: 30
      seconds: 0
    above: 25
  - trigger: numeric_state
    entity_id: sensor.current_phase_3
    for:
      hours: 0
      minutes: 30
      seconds: 0
    above: 25
  condition: []
  action:
  - action: notify.all_phones
    data:
      message: ⚡ Een van de drie fases zit te lang boven de 25A.
      data:
        persistent: true
        tag: persistent
  mode: single
- id: '1684664004500'
  alias: Pool - Control the locking of the pool cover
  description: When one of us is at home or the guest mode is enabled, keep the deck
    unlocked. Otherwise locked.
  trigger:
  - trigger: state
    entity_id:
    - person.rob
    - person.steffi
  - trigger: state
    entity_id:
    - input_boolean.guest_mode
  condition:
  - condition: state
    entity_id: input_boolean.enable_pool_automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
        - condition: numeric_state
          entity_id: zone.home
          above: 0
        alias: Is somebody home or is the guest mode on and aren't we sleeping?
      - condition: not
        conditions:
        - condition: state
          entity_id: alarm_control_panel.alarmo
          state: armed_night
      sequence:
      - action: lock.unlock
        data: {}
        target:
          entity_id: lock.aquadeck_rol_dek
    default:
    - action: lock.lock
      data: {}
      target:
        entity_id: lock.aquadeck_rol_dek
  mode: single
- id: '1684685043051'
  alias: Pool - Control the filter pump
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - schedule.pool_filter_pump_schedule
  condition:
  - condition: state
    entity_id: input_boolean.enable_pool_automations
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: schedule.pool_filter_pump_schedule
        state: 'on'
      sequence:
      - action: switch.turn_on
        data: {}
        target:
          entity_id: switch.pool_pomp_switch
    - conditions:
      - condition: state
        entity_id: schedule.pool_filter_pump_schedule
        state: 'off'
      sequence:
      - action: switch.turn_off
        data: {}
        target:
          entity_id: switch.pool_pomp_switch
  mode: single
- id: '1686403235095'
  alias: Irrigation - Start the sprinklers
  description: If the schedule is enabled and we've reached the start time, kick the
    esphome sprinkler instance
  trigger:
  - trigger: time
    at: input_datetime.irrigation_start_time
  condition:
  - condition: state
    entity_id: input_boolean.irrigation_plan_enable
    state: 'on'
  action:
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.irrigation_plan_enable
  - action: switch.turn_on
    data: {}
    target:
      entity_id: switch.irrigation_main_switch
  mode: single
- id: '1690629427860'
  alias: Motion Lights - Control corridor lights
  description: ''
  use_blueprint:
    path: robsonke/motion-illuminance-dimmable-nightmode.yaml
    input:
      motion_entity:
      - binary_sensor.hue_motion_sensor_corridor1_occupancy
      lux_entity: sensor.hue_motion_sensor_corridor1_illuminance_lux
      lux_level: 10
      light_target:
        entity_id: light.dimmer_corridor
      dim_time: 10
      no_motion_wait_day: 240
      day_brightness: 40
      night_brightness: 25
      no_motion_wait_night: 90
      night_time_end_helper: 08:00:00
- id: '1690717695663'
  alias: BBQ - Timer notifications
  description: Warns us in case of the bbq timer runs out
  trigger:
  - trigger: state
    entity_id:
    - timer.bbq
    from: active
    to: idle
    enabled: false
  - trigger: event
    event_type: timer.finished
    event_data:
      entity_id: timer.bbq
  condition:
  - condition: state
    entity_id: input_boolean.enable_bbq_automations
    state: 'on'
  action:
  - action: notify.all_phones
    data:
      message: BBQ Timer is klaar.
      data:
        persistent: true
        tag: persistent
  - action: script.sonos_say
    data:
      sonos_entity: media_player.eetkamer
      volume: 30
      message: Barbecue timer biep!
  mode: single
- id: '1690718896889'
  alias: BBQ - Probe 1 alarm
  description: Beeps when the bbq is on the wrong temperature, based on the range
    set
  trigger:
  - trigger: template
    value_template: '{% if (states[''sensor.inkbird_ibt_2x_temperature_probe_1''].state
      | int(-1) != -1 ) and states(''sensor.inkbird_ibt_2x_temperature_probe_1'')
      < 5000 and (states(''sensor.inkbird_ibt_2x_temperature_probe_1'') | round |
      int > states(''input_number.grill_alert_high'') | round | int or states(''sensor.inkbird_ibt_2x_temperature_probe_1'')
      | round | int < states(''input_number.grill_alert_low'') | round | int) %} true
      {% endif %}'
  condition:
  - condition: state
    entity_id: input_boolean.enable_bbq_automations
    state: 'on'
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.bbq_probe_1_alarm.attributes.last_triggered,
      0) | int > 60 }}'
  action:
  - action: notify.all_phones
    data:
      message: '♨️ BBQ Temperatuur te hoog of laag: {{ states[''sensor.inkbird_ibt_2x_temperature_probe_1''].state
        | round }}°C'
      data:
        persistent: true
        tag: persistent
  - action: script.sonos_say
    data:
      sonos_entity: media_player.eetkamer
      volume: 30
      message: 'Let op: De barbecue temperatuur is {{ states[''sensor.inkbird_ibt_2x_temperature_probe_1''].state
        | round }} graden!'
  mode: single
- id: '1690720476474'
  alias: BBQ - Probe 2 alarm
  description: Beeps when the bbq has reached the target temperature
  trigger:
  - trigger: template
    value_template: "{% if (states['sensor.inkbird_ibt_2x_temperature_probe_2'].state
      | int(-1) != -1 ) \n      and states('sensor.inkbird_ibt_2x_temperature_probe_2')
      < 5000\n      and states('sensor.inkbird_ibt_2x_temperature_probe_2') | round
      | int >= states('input_number.grill_probe_2_target') | round | int \n    %}
      true {% endif %}"
  condition:
  - condition: state
    entity_id: input_boolean.enable_bbq_automations
    state: 'on'
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.bbq_probe_2_alarm.attributes.last_triggered,
      0) | int > 60 }}'
  action:
  - action: notify.all_phones
    data:
      message: "\U0001F356 Het vlees op de BBQ is nu {{ states['sensor.inkbird_ibt_2x_temperature_probe_2'].state
        | round }}°C"
      data:
        persistent: true
        tag: persistent
  - action: script.sonos_say
    data:
      sonos_entity: media_player.eetkamer
      volume: 30
      message: 'Let op: Het vlees op de barbecue is nu {{ states[''sensor.inkbird_ibt_2x_temperature_probe_2''].state
        | round }} graden.'
  mode: single
- id: '1690914761794'
  alias: Motion Lights - Control shed lights
  description: Turn on the light in the shed once entering and turn off after a while
  use_blueprint:
    path: robsonke/motion-illuminance-dimmable-nightmode.yaml
    input:
      motion_entity:
      - binary_sensor.hue_motion_sensor_shed_occupancy
      lux_entity: sensor.hue_motion_sensor_shed_illuminance_lux
      lux_level: 250
      dim_time: 0
      no_motion_wait_day: 600
      day_brightness: 100
      light_target:
        entity_id:
        - light.shed_light
      night_time_start_helper: '22:00:00'
      night_time_end_helper: 07:00:00
      night_brightness: 100
- id: '1690920817114'
  alias: Motion Lights - Control shower & closet light
  description: ''
  use_blueprint:
    path: robsonke/motion-illuminance-dimmable-nightmode.yaml
    input:
      motion_entity:
      - binary_sensor.hue_motion_sensor_shower_occupancy
      lux_entity: sensor.hue_motion_sensor_shower_illuminance_lux
      lux_level: 250
      light_target:
        entity_id: light.dimmer_master_closetbath
      dim_time: 10
      no_motion_wait_day: 600
      night_time_start_helper: '22:00:00'
      night_time_end_helper: 06:00:00
      night_brightness: 30
      no_motion_wait_night: 60
      sleep_time_end_helper: 00:01:00
      sleep_time_start_helper: '23:59:00'
- id: '1691040868878'
  alias: Motion Lights - Control the toilet light downstairs
  description: ''
  use_blueprint:
    path: robsonke/toilet-light-control.yaml
    input:
      motion_entity: binary_sensor.motion_sensor_toiletdownstairs_occupancy
      door_entity: binary_sensor.toiletdoordownstairs_openclose_contact
      light_target: light.toilet_downstairs_light
      no_motion_wait: 20
      night_brightness: 40
- id: '1691085645048'
  alias: Motion Lights - Control the toilet light upstairs
  description: ''
  use_blueprint:
    path: robsonke/toilet-light-control.yaml
    input:
      motion_entity: binary_sensor.motion_sensor_toiletupstairs_occupancy
      door_entity: binary_sensor.toiletdoorupstairs_openclose_contact
      light_target: light.toilet_upstairs_light
      no_motion_wait: 5
      night_brightness: 33
- id: '1691091811857'
  alias: System - Alert when addons are down
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.important_addons
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition:
  - condition: state
    entity_id: binary_sensor.important_addons
    state: 'off'
  action:
  - action: persistent_notification.create
    data:
      title: Addons down
      message: "\U0001F4A1 Let op, er zijn addons down"
  mode: single
- id: '1691828355364'
  alias: Windows - Eva open and low temperature
  description: ''
  use_blueprint:
    path: robsonke/window-open-temperature.yaml
    input:
      temp_sensor: sensor.climate_sensor_eva_temperature
      window_sensor: binary_sensor.window_eva_openclose_contact
      min_temp: 15
      actions:
      - action: notify.all_phones
        data:
          message: "\U0001F3E0 Het raam bij Eva staat open en het begint nu wel een
            beetje fris te worden."
          data:
            persistent: true
            tag: persistent
- id: '1706294943705'
  alias: Music - Control sonos bedroom
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - sensor.hue_tap_switch_master_action
    to: button_4_press_release
  - trigger: state
    entity_id:
    - sensor.hue_tap_switch_master_action
    to: dial_rotate_right_step
  - trigger: state
    entity_id:
    - sensor.hue_tap_switch_master_action
    to: dial_rotate_left_step
  - trigger: state
    entity_id:
    - sensor.hue_tap_switch_master_action
    to: dial_rotate_left_fast
  - trigger: state
    entity_id:
    - sensor.hue_tap_switch_master_action
    to: dial_rotate_left_slow
  - trigger: state
    entity_id:
    - sensor.hue_tap_switch_master_action
    to: dial_rotate_right_fast
  - trigger: state
    entity_id:
    - sensor.hue_tap_switch_master_action
    to: dial_rotate_right_slow
  condition: []
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == "button_4_press_release" }}'
        alias: Button pressed
      sequence:
      - alias: If sonos plays, stop, otherwise play radio 2
        choose:
        - conditions:
          - condition: state
            entity_id: media_player.slaapkamer_sonos
            state: playing
            alias: Is sonos playing
          sequence:
          - action: media_player.media_stop
            target:
              entity_id: media_player.slaapkamer_sonos
            data: {}
            alias: Stop playing
        default:
        - alias: Play radio 2 on sonos
          action: media_player.play_media
          metadata: {}
          data:
            media_content_id: x-rincon-mp3radio://icecast.omroep.nl/radio2-bb-aac
            media_content_type: music
            metadata:
              title: NPO Radio 2
              thumbnail: https://upload.wikimedia.org/wikipedia/commons/b/b3/NPO_Radio_2_logo.png
              media_class: music
            extra:
              thumb: https://upload.wikimedia.org/wikipedia/commons/b/b3/NPO_Radio_2_logo.png
              title: NPO Radio 2
          target:
            entity_id: media_player.slaapkamer_sonos
    - conditions:
      - condition: and
        alias: Is sonos playing and did we turn the knob to the left
        conditions:
        - condition: template
          value_template: '{{ trigger.to_state.state == "dial_rotate_left_step" or
            trigger.to_state.state == "dial_rotate_left_fast" or trigger.to_state.state
            == "dial_rotate_left_slow" }}'
        - condition: state
          entity_id: media_player.slaapkamer_sonos
          state: playing
      sequence:
      - action: media_player.volume_set
        data_template:
          volume_level: '{{ states.media_player.slaapkamer_sonos.attributes.volume_level
            - 0.03}}'
        entity_id: media_player.slaapkamer_sonos
    - conditions:
      - condition: and
        alias: Is sonos playing and did we turn the knob to the right
        conditions:
        - condition: template
          value_template: '{{ trigger.to_state.state == "dial_rotate_right_step" or
            trigger.to_state.state == "dial_rotate_right_fast" or trigger.to_state.state
            == "dial_rotate_right_slow" }}'
        - condition: state
          entity_id: media_player.slaapkamer_sonos
          state: playing
      sequence:
      - action: media_player.volume_set
        data_template:
          volume_level: '{{ states.media_player.slaapkamer_sonos.attributes.volume_level
            + 0.03}}'
        entity_id: media_player.slaapkamer_sonos
  mode: single
- id: '1707053269958'
  alias: iOS - Open frontdoor
  description: Open the door from car or watch
  trigger:
  - trigger: event
    event_type: ios.action_fired
    event_data:
      actionName: open_frontdoor
  condition: []
  action:
  - action: lock.open
    target:
      entity_id: lock.nuki_voordeur_slot_lock
    data: {}
  - action: alarm_control_panel.alarm_disarm
    target:
      entity_id: alarm_control_panel.alarmo
    data:
      code: automation
  mode: single
- id: '1709065308888'
  alias: Light - Turn off all in bedroom and lower the beds
  description: Hold the first button on the Hue Tap to turn off all lights and music
    and lower the beds
  triggers:
  - entity_id:
    - sensor.hue_tap_switch_master_action
    to: button_1_hold
    trigger: state
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.dimmer_master_closetbath
      - light.bedroom_sonos_light
      - light.dimmer_masterbed
  - action: media_player.media_stop
    metadata: {}
    data: {}
    target:
      entity_id: media_player.slaapkamer_sonos
  - action: rest_command.auping_bed
    metadata: {}
    data:
      cbu: 1
      motor_1_action: 2
      motor_1_time: 0
      motor_2_action: 0
      motor_2_time: 30000
      motor_3_action: 0
      motor_3_time: 0
  - action: rest_command.auping_bed
    metadata: {}
    data:
      cbu: 2
      motor_1_action: 2
      motor_1_time: 0
      motor_2_action: 0
      motor_2_time: 30000
      motor_3_action: 0
      motor_3_time: 0
  mode: single
- id: '1715023558828'
  alias: Doors - Unlock the front door on week days at 7:00
  description: And only when we're home
  trigger:
  - trigger: time
    at: 07:00:00
    alias: Trigger every day at 7:00 in the morning
  condition:
  - condition: state
    entity_id: binary_sensor.workday_rob
    state: 'on'
    alias: Confirm it's a week day
  - condition: numeric_state
    entity_id: zone.home
    above: 0
    alias: At least somebody home?
  action:
  - action: lock.unlock
    metadata: {}
    data: {}
    target:
      entity_id: lock.nuki_voordeur_slot_lock
  mode: single
- id: '1715282105706'
  alias: Alarm - Interrupt the manual pause in case one of us comes home
  description: This is to avoid that the alarm switches back on after 2 hours and
    freaking us out
  trigger:
  - trigger: numeric_state
    entity_id:
    - zone.home
    above: 0
  condition:
  - condition: template
    value_template: '{{ state_attr(''automation.alarm_disable_alarm_manually'', ''current'')
      > 0 }}'
    alias: Is the "Disable alarm manually" automation running?
  action:
  - action: automation.turn_off
    metadata: {}
    data:
      stop_actions: true
    target:
      entity_id: automation.alarm_disable_alarm_manually
  - action: automation.turn_on
    target:
      entity_id:
      - automation.alarm_disable_alarm_manually
    data: {}
  mode: single
- id: '1716736577091'
  alias: Frigate / Generative AI / Notification TEST
  description: ''
  trigger:
  - trigger: mqtt
    topic: frigate/events
    payload: new
    value_template: '{{ value_json.type }}'
  - trigger: mqtt
    topic: frigate/events
    payload: update
    value_template: '{{ value_json.type }}'
  condition:
  - condition: template
    value_template: '{{ camera_entity != ''camera.evabed'' }}'
    alias: Skip Eva's camera
  - condition: template
    value_template: '{{ camera_entity != ''camera.noabed'' }}'
    alias: Skip Noa's camera
  - condition: template
    value_template: '{{ states(''switch.'' ~ camera_name ~ ''_detect'') == ''on''
      }}'
    alias: Is the detect switch on for that camera?
  - condition: or
    conditions:
    - condition: state
      entity_id: zone.home
      state: '0'
      alias: Are we all away?
    - condition: state
      entity_id: alarm_control_panel.alarmo
      state: armed_night
    alias: Are we away or is the night alarm active
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.test_frigate_generative_ai_notification.attributes.last_triggered,
      0) | int > 20 }}'
    alias: Only trigger once per 20 seconds
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  action:
  - action: camera.snapshot
    metadata: {}
    data:
      filename: downloads/latest_front_{{ camera_entity }}.jpg
    target:
      entity_id: '{{ camera_entity }}'
  - action: google_generative_ai_conversation.generate_content
    metadata: {}
    data:
      image_filename: downloads/latest_front_{{ camera_entity }}.jpg
      prompt: Very briefly describe what you see in this image from my security camera.
        Your message needs to be short to fit in a phone notification. Don't describe
        stationary objects, plants or buildings. And please answer in Dutch.
    response_variable: generated_content
  - action: input_text.set_value
    metadata: {}
    data:
      value: '{{ generated_content.text }}'
    target:
      entity_id: input_text.camera_analysis
  - action: persistent_notification.create
    data:
      title: Camera
      message: '{{ generated_content.text }} ![image](https://home.tigrou.nl/api/frigate/notifications/{{trigger.payload_json["after"]["id"]}}/thumbnail.jpg)'
  - action: notify.mobile_app_iphone_rob
    data:
      message: ' {{ generated_content.text }} '
      data:
        image: https://home.tigrou.nl/api/frigate/notifications/{{trigger.payload_json["after"]["id"]}}/thumbnail.jpg
        tag: '{{trigger.payload_json["after"]["id"]}}'
        when: '{{trigger.payload_json["after"]["start_time"]|int}}'
        entity_id: '{{ camera_entity }}'
        data:
          url: /ccab4aaf_frigate/ingress
        push:
          category: camera
  variables:
    camera_entity: camera.{{trigger.payload_json["after"]["camera"] | replace("-","_")
      | lower}}
    camera_name: '{{trigger.payload_json["after"]["camera"] | replace("-","_") | lower}}'
  mode: single
- id: '1716926628476'
  alias: Sleep - Turn off last lights around 11 pm
  description: ''
  triggers:
  - trigger: time
    at: '22:55:00'
  conditions:
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: armed_night
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.socket1_light_corner
      - light.socket2_light_couch
      - light.kerst_binnen
  mode: single
- id: '1718380304677'
  alias: Energy - Disable solar panels in case of negative pricing
  description: Avoid paying for delivering energy but also limit the impact on the
    power grid in case there is no need
  trigger:
  - trigger: state
    entity_id:
    - sensor.current_price_electricity
  condition: []
  action:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.current_price_electricity
        below: 0
      - condition: state
        entity_id: number.solaredgemb_active_power_limit
        state: '100'
      sequence:
      - action: number.set_value
        metadata: {}
        data:
          value: '0'
        target:
          entity_id: number.solaredgemb_active_power_limit
        alias: Disable the solar panels
      - action: persistent_notification.create
        data:
          title: Zonnepanelen
          message: "\U0001F31E De zonnepanelen zijn uitgezet vanwege een stroomprijs
            van {{ states.sensor.current_price_electricity }} cent."
    - conditions:
      - condition: numeric_state
        entity_id: sensor.current_price_electricity
        above: 0
      - condition: state
        entity_id: number.solaredgemb_active_power_limit
        state: '0'
      sequence:
      - action: number.set_value
        metadata: {}
        data:
          value: '100'
        target:
          entity_id: number.solaredgemb_active_power_limit
        alias: Enable the solar panels
      - action: persistent_notification.create
        data:
          title: Zonnepanelen
          message: "\U0001F31E De zonnepanelen zijn weer aangezet vanwege een stroomprijs
            van {{ states.sensor.current_price_electricity }} cent."
  mode: single
- id: '1724489164994'
  alias: System - Remove state history of heavy sensors
  description: Like power consumption and production
  trigger:
  - trigger: time
    at: 04:00:00
  condition: []
  action:
  - action: recorder.purge_entities
    metadata: {}
    data:
      keep_days: 4
      entity_id:
      - sensor.power_consumed
      - sensor.power_produced
      - sensor.power_consumed_phase_3
      - sensor.power_produced_phase_3
      - sensor.power_produced_phase_2
      - sensor.power_consumed_phase_2
      - sensor.power_produced_phase_1
      - sensor.power_consumed_phase_1
      - sensor.winecooler_switch_current_consumption
      - sensor.pool_shelly_3em_phase_a_active_power
      - sensor.pool_shelly_3em_phase_b_active_power
      - sensor.pool_shelly_3em_phase_c_active_power
      - sensor.electricity_cost_today
      - sensor.power_langeweide_28
      - sensor.power_production_langeweide_28
      - sensor.processor_use
      - sensor.runtime
      - sensor.winddir
      domains: weather
      entity_globs: sensor.*voltage* sensor.shelly_*_power sensor.*detection_fps
  mode: single
- id: '1726401797955'
  alias: System - Wallpanel Battery Management
  description: Disable charging when reaching 80%
  use_blueprint:
    path: robsonke/wallpanel_battery_management.yaml
    input:
      battery: sensor.ipad_kitchen_battery_level
      low_percent: 25
      charger: switch.shelly_plug_s_10_relay
- id: '1731700097529'
  alias: Voice - Save reminders for todos
  description: ''
  use_blueprint:
    path: robsonke/voice-reminder.yaml
    input:
      open_ai_config_entry: cf03b58d0a8b7a1b3949a78c99277abd
      todo_list: todo.todo_reminders
      notify_service: notify.mobile_app_iphone_rob
      assist_command:
      - Herinner mij {reminderDescription} om {reminderTime}
      response_sentence_text: 'Je ontvangt een herinnering: {{trigger.slots.reminderDescription}}
        at {{response_from_ai.response.speech.plain.speech}} o'' clock.'
- id: '1732450018331'
  alias: Alarm - AI Event Summary
  description: Keep an eye on the doorbell camera and explain what is happening.
  use_blueprint:
    path: valentinfrlch/event_summary.yaml
    input:
      mode: Frigate
      important: true
      remember: true
      notify_device:
      - 9e1fc8113280a61adb50d2da08fb8dde
      camera_entities:
      - camera.doorbell
      cooldown: 20
      provider: 01JDEYNQ5SNASP96EZQVX71J66
      model: gemini-1.5-pro
- &id001
  id: '1734980264542'
  alias: Motion Lights - Control hall lights
  description: ''
  use_blueprint:
    path: robsonke/motion-illuminance-dimmable-nightmode.yaml
    input:
      motion_entity:
      - binary_sensor.hue_motion_sensor_hall_occupancy
      lux_entity: sensor.hue_motion_sensor_hall_illuminance_lux
      lux_level: 35
      light_target:
        entity_id: light.dimmer_hall
      no_motion_wait_day: 60
      no_motion_wait_night: 60
      dim_time: 5
      day_brightness: 45
      night_brightness: 30
      sleep_time_start_helper: '23:59:59'
      sleep_time_end_helper: 00:00:01
- *id001
- id: '1735328989280'
  alias: HVAC - Check and reset the target temp of heat pump
  description: Temporary automation, something overrules the target temperature and
    keeps us cold. Most likely a race condition.
  triggers:
  - trigger: state
    entity_id:
    - climate.warmtepomp
    attribute: temperature
    for:
      hours: 0
      minutes: 1
      seconds: 0
  conditions:
  - condition: template
    value_template: '''{{ state_attr(''climate.warmtepomp'', ''temperature'')|int
      !=  states(''input_number.hvac_winter_target_temperature'')|int }}'''
  actions:
  - action: persistent_notification.create
    metadata: {}
    data:
      message: Target heatpump temp differs from settings, try resetting in one minute
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - choose:
    - conditions:
      - condition: state
        entity_id: select.operation_mode
        state: heating
      sequence:
      - action: climate.set_temperature
        data_template:
          temperature: '{{ states(''input_number.hvac_winter_target_temperature'')
            | float }}'
        target:
          entity_id: climate.warmtepomp
        alias: Heat - Set temperature to the winter target during the day
    - conditions:
      - condition: state
        entity_id: select.operation_mode
        state: cooling
      sequence:
      - action: climate.set_temperature
        data_template:
          temperature: '{{ states(''input_number.hvac_summer_target_temperature'')
            | float }}'
        target:
          entity_id: climate.warmtepomp
        alias: Cool - Set temperature to the summer target
    alias: Set the right target temperature, depending on season
  mode: single
- id: '1735414213615'
  alias: System - check if the power in the shed is oke
  description: Due to water in the garden, the outside power went off a few times.
    Lets detect these moments.
  triggers:
  - trigger: state
    entity_id:
    - sensor.access_point_u7_outdoor_state
    from: Connected
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - trigger: state
    entity_id:
    - switch.shelly_plug_s_8_fridge1_relay
    from: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions: []
  actions:
  - action: persistent_notification.create
    metadata: {}
    data:
      message: Is the power in the shed still oke? Either the Outdoor AP or fridge
        is off / unavailable. Please check
      title: Power issue shed?
  mode: single

action: fire-dom-event
browser_mod:
  command: popup
  title: Energie verbruik en kosten
  large: true
  card:
    type: custom:layout-card
    layout_type: custom:grid-layout
    layout:
      grid-template-columns: 60% 40%
      grid-template-rows: auto
      grid-template-areas: |
        "details details2"
      mediaquery:
        "(max-width: 800px)":
          grid-template-columns: auto
          grid-template-rows: auto
          grid-template-areas: |
            "details"
            "details2"
    cards:
      - type: vertical-stack
        view_layout:
          grid-area: details
        cards:
          - type: horizontal-stack
            cards:
              - type: energy-distribution
                link_dashboard: true
                view_layout:
                  position: sidebar
              - type: gauge
                name: Energie verbruik
                unit: kW
                entity: sensor.power_consumed
                min: 0
                needle: true
                severity:
                  green: 0
                  yellow: 3
                  red: 8
                max: 20
              - type: gauge
                name: Energie productie
                unit: kW
                entity: sensor.power_produced
                min: 0
                needle: true
                severity:
                  green: 0
                  yellow: 3
                  red: 6
                max: 10
          - type: energy-usage-graph

          - type: custom:apexcharts-card
            config_templates: energy_chart
            all_series_config:
              type: line
              group_by:
                duration: 10min
                func: max
            series:
              - entity: sensor.altherma_power_usage
                name: Altherma Primary
              - entity: sensor.altherma_power_usage_secundary
                name: Altherma Secondary
              - entity: sensor.shelly_plug_s_7_meterkast2_power
                name: Meterkast2
              - entity: sensor.vaatwasser_switch_current_consumption
                name: Vaatwasser
              - entity: sensor.wasmachine_switch_current_consumption
                name: Wasmachine
              - entity: sensor.winecooler_switch_current_consumption
                name: Wijnkoeler
              - entity: sensor.shelly_plug_droger_power
                name: Droger
              - entity: sensor.shelly_plug_office_power
                name: Kantoor
              - entity: sensor.eurom_alutherm_power
                name: Verwarming slaapkamer
              - entity: sensor.shelly_plug_badkamer_verwarming_power
                name: Verwarming Badkamer
              - entity: sensor.shelly_plug_douche_verwarming_power
                name: Verwarming Douche
              - entity: sensor.shelly_plug_s_6_meterkast1_power
                name: Meterkast1
              - entity: sensor.shelly_plug_s_8_fridge1_power
                name: Vriezer Schuur
              - entity: sensor.infrarood_slaapkamer_current_consumption
                name: Verwarming Logeerkamer
              - entity: sensor.infraroodpanel_eva_current_consumption
                name: Verwarming Eva

          - type: energy-devices-graph
          - type: entities
            entities:
              - entity: sensor.power_consumed
              - entity: sensor.daily_consumption_energy
                name: Power Consumption Today
                icon: mdi:counter
              - entity: sensor.solaredge_energy_today
                name: Power Production Today
              - entity: sensor.monthly_consumption_energy
                name: Power Consumption this Month
              - entity: sensor.solaredge_energy_this_month
                name: Power Production this Month
              - entity: sensor.yearly_consumption_energy
                name: Power Consumption this Year
              - entity: sensor.solaredge_energy_this_year
                name: Power Production this Year
            state_color: false
            title: Energie totalen

      - type: vertical-stack
        view_layout:
          grid-area: details2
        cards:
          - type: entities
            title: Tarieven vandaag en morgen
            entities:
              - type: attribute
                entity: sensor.nordpool_kwh_nl_eur_3_10_021
                name: Gemiddeld kWh prijs vandaag
                attribute: average
                suffix: Cent
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            graph_span: 1d
            span:
              start: day
            series:
              - entity: sensor.nordpool_kwh_nl_eur_3_10_021
                data_generator: |
                  return entity.attributes.raw_today.map((entry) => {
                    return [new Date(entry.start), entry.value];
                  });
                type: column
                float_precision: 2
                show:
                  extremas: true
                color_threshold:
                  - value: 0
                    color: blue
                  - value: 15
                    color: green
                  - value: 30
                    color: darkorange
                  - value: 40
                    color: red
                  - value: 50
                    color: darkred
                  - value: 60
                    color: black
            now:
              show: true
              color: '#ff0000'
            yaxis:
              - min: 0
                decimals: 2
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            graph_span: 1d
            span:
              start: day
              offset: +1d
            series:
              - entity: sensor.nordpool_kwh_nl_eur_3_10_021
                data_generator: |
                  return entity.attributes.raw_tomorrow.map((entry) => {
                    return [new Date(entry.start), entry.value];
                  });
                type: column
                float_precision: 2
                show:
                  extremas: true
                color_threshold:
                  - value: 0
                    color: blue
                  - value: 15
                    color: green
                  - value: 30
                    color: darkorange
                  - value: 40
                    color: red
                  - value: 50
                    color: darkred
                  - value: 60
                    color: black
            yaxis:
              - min: 0
                decimals: 2
          - type: energy-sources-table
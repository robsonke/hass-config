# __        __         _   _
# \ \      / /__  __ _| |_| |__   ___ _ __
#  \ \ /\ / / _ \/ _` | __| '_ \ / _ \ '__|
#   \ V  V /  __/ (_| | |_| | | |  __/ |
#    \_/\_/ \___|\__,_|\__|_| |_|\___|_|
#
# Author: Rob Sonke
# https://github.com/robsonke/hass-config
#

weather:
  - platform: template
    name: "Weather Langeweide Ecowitt"
    unique_id: "langeweide_ecowitt"
    attribution_template: "Local Ecowitt Weatherstation on our roof"
    condition_template: "{{ states('weather.home') }}"
    temperature_template: "{{ states('sensor.temp') | float(default=states('sensor.kloetinge_temperature') | float(default=0)) }}"
    wind_bearing_template: "{{ states('sensor.winddir') | float(default=states('sensor.kloetinge_wind_direction') | float(default=0)) }}"
    wind_speed_template: "{{ states('sensor.windspeed') | float(default=states('sensor.kloetinge_wind_speed') | float(default=0)) }}"
    humidity_template: "{{ states('sensor.humidity') | float(default=states('sensor.kloetinge_humidity') | float(default=0)) }}"
    forecast_template: "{{ state_attr('weather.home', 'forecast') }}"
    pressure_template: "{{ state_attr('weather.home', 'pressure') }}"
    # invalid according to editor, but not according to HA
    temperature_unit: "Â°C"
    visibility_unit: "km"
    wind_speed_unit: "km/h"
    pressure_unit: "hPa"

template:
  - sensor:
    - name: "Today Maximum Temperature"
      icon: mdi:thermometer
      unique_id: today_maximum_temperature
      state: >
        {{ states.weather.openweathermap.attributes.forecast[0].temperature | float(default=20) }}
    - name: "Wind Force"
      icon: mdi:weather-windy
      unique_id: wind_force
      state: >
        {% set wind = states('sensor.kloetinge_wind_speed')|float %}
        {% set wind_round = wind|round(1) %}
        {% if wind <= 1 %}0 Bft, Windstil
        {% elif wind <= 5 %}1 Bft, Zwak: flauwe wind
        {% elif wind <= 11 %}2 Bft, Zwak
        {% elif wind <= 20 %}3 Bft, Matig: lichte bries
        {% elif wind <= 28 %}4 Bft, Matig: flauwe bries
        {% elif wind <= 39 %}5 Bft, Vrij krachtig
        {% elif wind <= 50 %}6 Bft, Krachtig
        {% elif wind <= 62 %}7 Bft, Hard
        {% elif wind <= 75 %}8 Bft, Stormachting
        {% elif wind <= 89 %}9 Bft, Storm
        {% elif wind <= 103 %}10 Bft, Zware storm
        {% elif wind <= 117 %}11 Bft, Zeer zware storm
        {% else %} > 117 %}12 Bft, Orkaan
        {%- endif %}
